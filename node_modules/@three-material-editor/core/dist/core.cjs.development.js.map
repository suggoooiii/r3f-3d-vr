{"version":3,"file":"core.cjs.development.js","sources":["../../../node_modules/style-inject/dist/style-inject.es.js","../src/state.tsx","../src/helpers/regex.tsx","../src/helpers/formatter.tsx","../src/cshader.ts","../src/components/tabs/tabs.tsx","../src/helpers/shaderToMaterial.tsx","../src/components/menu/menuLi.tsx","../src/components/menu/menuSub.tsx","../src/components/menu/menuHead.tsx","../src/components/menu/menuActions.tsx","../src/components/menu/menuUniforms.tsx","../src/components/menu/menu.tsx","../src/fullscreen.tsx","../src/editor.tsx","../src/helpers/improveMaterial.tsx","../src/middleware.tsx","../src/index.tsx"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import { Material, Scene } from 'three';\nimport { proxy } from 'valtio';\nimport { devtools } from 'valtio/utils';\n\nexport interface State {\n  showMenu: boolean;\n  showEditor: boolean;\n  fullScreen: boolean;\n  className: string;\n  diffMode: boolean;\n  showUniforms: boolean;\n  obcMode: boolean;\n  triggerUpdate: number;\n  length: number;\n  scene: Scene | null;\n  diagnostics: any | null;\n  composer: any | null;\n  materials: Material[];\n  tabs: any;\n  activeMaterial: {\n    type: string;\n    open: boolean;\n    cache?: any;\n    isModif: boolean;\n    model?: null | string;\n    cachedModel?: null | string;\n  };\n}\n\nexport const editorState = proxy<State>({\n  className: '',\n  showMenu: false,\n  showEditor: false,\n  showUniforms: false,\n  fullScreen: true,\n  diffMode: false,\n  obcMode: false,\n  length: 0,\n  triggerUpdate: 0,\n  scene: null,\n  composer: null,\n  materials: [],\n  diagnostics: {},\n  tabs: {},\n  activeMaterial: {\n    type: '',\n    open: false,\n    model: null,\n    cachedModel: null,\n    isModif: false,\n    cache: {\n      vert: '',\n      frag: '',\n    },\n  },\n});\ndevtools(editorState, 'material editor');\n\ninterface Map {\n  [key: string]: any;\n}\n\nexport const editorContextState: Map = {\n  materials: {},\n  activeMaterialRef: {},\n  programs: [],\n  editorWidth: 520,\n  editorMinusHeight: 0,\n  gl: null,\n};\n","/**\n * Regular expression for matching the `void main() {` opener line in GLSL.\n * @type {RegExp}\n */\nexport const voidMainRegExp: any = /\\bvoid\\s+main\\s*\\(\\s*\\)\\s*{/g;\n\nexport const commentedIncludeRegExp: any = /^(\\s*)\\/\\/ #include <([a-zA-Z0-9_]+)>/gm;\n\nexport const includeRegExp: any = /^(\\s*)#include <([a-zA-Z0-9_]+)>/gm;\n\nexport function getMainExtents(text: string) {\n  const mainRegex = /void\\s*main\\s*\\(.*?\\)[\\s\\S]*?\\{/g;\n  const mainResult = mainRegex.exec(text);\n\n  if (!mainResult) {\n    return null;\n  }\n\n  const braceRegex = /[{}]/g;\n  braceRegex.lastIndex = mainRegex.lastIndex + mainResult[0].length;\n\n  const before = mainRegex.lastIndex - mainResult[0].length;\n  const after = mainRegex.lastIndex;\n  let end = 0;\n\n  let braceCount = 1;\n  let lastResult;\n  while ((lastResult = braceRegex.exec(text))) {\n    const brace = lastResult[0];\n    if (brace === '{') {\n      braceCount++;\n    } else {\n      braceCount--;\n      if (braceCount === 0) {\n        end = lastResult.index - 1;\n        break;\n      }\n    }\n  }\n\n  return { before, after, end };\n}\n","import { ShaderChunk } from 'three';\nimport { editorContext } from '..';\nimport { editorState } from '../state';\nimport { commentedIncludeRegExp, includeRegExp } from './regex';\n\nexport const replaceShaderChunks = (code: string | undefined) => {\n  if (typeof code !== 'string') {\n    return\n  }\n  const format = code.replaceAll(\n    includeRegExp,\n    (_substring: any, _indent: any, name: any) => {\n      let chunk = ShaderChunk[name];\n      chunk = chunk.split('\\n').map(line => line).join(`\\n\\t`);\n\n      return `// #include <${name}>\\n\\t${chunk}\\n//\\n`;\n    }\n  );\n  return format;\n};\n\nconst _formatToObc = (code: string | undefined) => {\n  if (typeof code !== 'string') {\n    return\n  }\n  const resetIncludes = code\n    .replaceAll(\n      commentedIncludeRegExp,\n      (_substring: any, _indent: any, name: any) => {\n        return `#include <${name}>`;\n      }\n    )\n    .trim();\n\n  const result = resetIncludes.split(includeRegExp);\n\n  var filtered = result.filter(function(el) {\n    return el !== '';\n  });\n  return filtered;\n};\n\nexport const generateHMRObc = (shader: any) => {\n  if (!editorContext.monacoRef) {\n    return ''\n  }\n  const model = editorState.activeMaterial.model;\n  const oModel = editorContext.monacoRef.editor\n    .getModel(model + '_orig')\n    .getValue();\n  const mModel = editorContext.monacoRef.editor.getModel(model).getValue();\n  let newValue = oModel;\n  // set back comments to #include\n  const base = _formatToObc(oModel);\n  const edited = _formatToObc(mModel);\n  const result = new Map();\n  if (!base || !edited) {\n    return ''\n  }\n  for (let index = 0; index < base.length; index++) {\n    const b = base[index];\n    const e = edited[index];\n    if (b !== e && Object.keys(e).length !== 0) {\n      result.set(edited[index - 1], e);\n    }\n  }\n\n  if (result.size > 0) {\n    result.forEach((value: string, key: any) => {\n      shader.fragmentShader = shader.fragmentShader.replace(\n        `#include <${key}>`,\n        `${value}`\n      );\n    });\n  }\n  return newValue;\n};\n\nexport const generateOBc = (_code: string |Â undefined) => {\n  const model = editorState.activeMaterial.cachedModel;\n  const type = editorState.activeMaterial.type === 'frag' ? 'fragmentShader' : 'vertexShader';\n  const oModel = editorContext.monacoRef.editor\n    .getModel(model + '_orig')\n    .getValue();\n  const mModel = editorContext.monacoRef.editor.getModel(model).getValue();\n\n  const base = _formatToObc(oModel);\n  const edited = _formatToObc(mModel);\n  const result = new Map();\n  if (!base || !edited) {\n    return ''\n  }\n  for (let index = 0; index < base.length; index++) {\n    const b = base[index];\n    const e = edited[index];\n    if (b !== e) {\n      result.set(edited[index - 1], e);\n    }\n  }\n  let onBeforeCompileFunction = `// generated using three-material-editor\\nmaterial.onBeforeCompile = (shader) => {\\n`;\n  result.forEach((value: string, key: any) => {\n    // minify\n    const valueFormated =\n      value.length > 500 ? value.trim().replace(/(\\r\\n|\\n|\\r)/gm, '') : value;\n    onBeforeCompileFunction += `${\n      value.length > 500 ? '\\t// > 500 characters - auto minified\\n' : ''\n    }\\tshader.${type} = shader.${type}.replace(\\`#include <${key}>\\`, \\`${valueFormated} \\`);\\n`;\n  });\n  onBeforeCompileFunction += `}\\n`;\n\n  editorState.obcMode = true;\n  editorState.triggerUpdate++;\n  return onBeforeCompileFunction;\n};\n","import { languages } from 'monaco-editor';\n\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport IRichLanguageConfiguration = languages.LanguageConfiguration;\nimport ILanguage = languages.IMonarchLanguage;\n\nexport const conf: IRichLanguageConfiguration = {\n  comments: {\n    lineComment: '//',\n    blockComment: ['/*', '*/'],\n  },\n  brackets: [\n    ['{', '}'],\n    ['[', ']'],\n    ['(', ')'],\n  ],\n  autoClosingPairs: [\n    { open: '[', close: ']' },\n    { open: '{', close: '}' },\n    { open: '(', close: ')' },\n    { open: \"'\", close: \"'\", notIn: ['string', 'comment'] },\n    { open: '\"', close: '\"', notIn: ['string'] },\n  ],\n  surroundingPairs: [\n    { open: '{', close: '}' },\n    { open: '[', close: ']' },\n    { open: '(', close: ')' },\n    { open: '\"', close: '\"' },\n    { open: \"'\", close: \"'\" },\n  ],\n  folding: {\n    markers: {\n      start: new RegExp('^\\\\s*#pragma\\\\s+region\\\\b'),\n      end: new RegExp('^\\\\s*#pragma\\\\s+endregion\\\\b'),\n    },\n  },\n};\n\nexport const language = {\n  defaultToken: '',\n  tokenPostfix: '.cpp',\n\n  brackets: [\n    { token: 'delimiter.curly', open: '{', close: '}' },\n    { token: 'delimiter.parenthesis', open: '(', close: ')' },\n    { token: 'delimiter.square', open: '[', close: ']' },\n    { token: 'delimiter.angle', open: '<', close: '>' },\n  ],\n\n  keywords: [\n    'discard',\n    'length',\n    'smoothstep',\n    'uniform',\n    'precision',\n    'mediump',\n    'highp',\n    'vec2',\n    'vec3',\n    'vec4',\n    'ivec2',\n    'ivec3',\n    'ivec4',\n    'abstract',\n    'amp',\n    'array',\n    'auto',\n    'bool',\n    'break',\n    'case',\n    'catch',\n    'char',\n    'class',\n    'const',\n    'gl_FragColor',\n    'constexpr',\n    'const_cast',\n    'continue',\n    'cpu',\n    'decltype',\n    'default',\n    'delegate',\n    'delete',\n    'do',\n    'double',\n    'dynamic_cast',\n    'each',\n    'else',\n    'enum',\n    'event',\n    'explicit',\n    'export',\n    'extern',\n    'false',\n    'final',\n    'finally',\n    'float',\n    'for',\n    'friend',\n    'gcnew',\n    'generic',\n    'goto',\n    'if',\n    'in',\n    'initonly',\n    'inline',\n    'int',\n    'interface',\n    'interior_ptr',\n    'internal',\n    'literal',\n    'long',\n    'mutable',\n    'namespace',\n    'new',\n    'noexcept',\n    'nullptr',\n    '__nullptr',\n    'operator',\n    'override',\n    'partial',\n    'pascal',\n    'pin_ptr',\n    'private',\n    'property',\n    'protected',\n    'public',\n    'ref',\n    'register',\n    'reinterpret_cast',\n    'restrict',\n    'return',\n    'safe_cast',\n    'sealed',\n    'short',\n    'signed',\n    'sizeof',\n    'static',\n    'static_assert',\n    'static_cast',\n    'struct',\n    'switch',\n    'template',\n    'this',\n    'thread_local',\n    'throw',\n    'tile_static',\n    'true',\n    'try',\n    'typedef',\n    'typeid',\n    'typename',\n    'union',\n    'unsigned',\n    'using',\n    'virtual',\n    'void',\n    'volatile',\n    'wchar_t',\n    'where',\n    'while',\n  ],\n\n  typeKeywords: 'float int bool void\\nvec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4\\nmat2 mat3 mat4\\nsampler2D sampler3D samplerCube\\nconst attribute uniform varying'.split(\n    /\\s+/\n  ),\n\n  operators: [\n    '=',\n    '>',\n    '<',\n    '!',\n    '~',\n    '?',\n    ':',\n    '==',\n    '<=',\n    '>=',\n    '!=',\n    '&&',\n    '||',\n    '++',\n    '--',\n    '+',\n    '-',\n    '*',\n    '/',\n    '&',\n    '|',\n    '^',\n    '%',\n    '<<',\n    '>>',\n    '>>>',\n    '+=',\n    '-=',\n    '*=',\n    '/=',\n    '&=',\n    '|=',\n    '^=',\n    '%=',\n    '<<=',\n    '>>=',\n    '>>>=',\n  ],\n\n  // we include these common regular expressions\n  symbols: /[=><!~?:&|+\\-*/^%]+/,\n  escapes: /\\\\(?:[abfnrtv\\\\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,\n  integersuffix: /(ll|LL|u|U|l|L)?(ll|LL|u|U|l|L)?/,\n  floatsuffix: /[fFlL]?/,\n  encoding: /u|u8|U|L/,\n\n  // The main tokenizer for our languages\n  tokenizer: {\n    root: [\n      // C++ 11 Raw String\n      [\n        /@encoding?R\"(?:([^ ()\\\\\\t]*))\\(/,\n        { token: 'string.raw.begin', next: '@raw.$1' },\n      ],\n\n      // identifiers and keywords\n      [\n        /[a-z_$][\\w$]*/,\n        {\n          cases: {\n            '@typeKeywords': 'keyword',\n            '@keywords': 'keyword',\n            '@default': 'identifier',\n          },\n        },\n      ],\n      [/[A-Z][\\w$]*/, 'type.identifier'], // to show class names nicely\n\n      // whitespace\n      { include: '@whitespace' },\n\n      // [[ attributes ]].\n      [/\\[\\[.*\\]\\]/, 'annotation'],\n\n      [\n        /^\\s*#include/,\n        { token: 'keyword.directive.include', next: '@include' },\n      ],\n\n      // Preprocessor directive\n      [/^\\s*#\\s*\\w+/, 'keyword'],\n\n      // delimiters and operators\n      [/[{}()[\\]]/, '@brackets'],\n      [/[<>](?!@symbols)/, '@brackets'],\n      [\n        /@symbols/,\n        {\n          cases: {\n            '@operators': 'delimiter',\n            '@default': '',\n          },\n        },\n      ],\n\n      // numbers\n      [/\\d*\\d+[eE]([-+]?\\d+)?(@floatsuffix)/, 'number.float'],\n      [/\\d*\\.\\d+([eE][-+]?\\d+)?(@floatsuffix)/, 'number.float'],\n      [/0[xX][0-9a-fA-F']*[0-9a-fA-F](@integersuffix)/, 'number.hex'],\n      [/0[0-7']*[0-7](@integersuffix)/, 'number.octal'],\n      [/0[bB][0-1']*[0-1](@integersuffix)/, 'number.binary'],\n      [/\\d[\\d']*\\d(@integersuffix)/, 'number'],\n      [/\\d(@integersuffix)/, 'number'],\n\n      // delimiter: after number because of .\\d floats\n      [/[;,.]/, 'delimiter'],\n\n      // strings\n      [/\"([^\"\\\\]|\\\\.)*$/, 'string.invalid'], // non-teminated string\n      [/\"/, 'string', '@string'],\n\n      // characters\n      [/'[^\\\\']'/, 'string'],\n      [/(')(@escapes)(')/, ['string', 'string.escape', 'string']],\n      [/'/, 'string.invalid'],\n    ],\n\n    whitespace: [\n      [/[ \\t\\r\\n]+/, ''],\n      [/\\/\\*\\*(?!\\/)/, 'comment.doc', '@doccomment'],\n      [/\\/\\*/, 'comment', '@comment'],\n      [/\\/\\/.*$/, 'comment'],\n    ],\n\n    comment: [\n      [/[^/*]+/, 'comment'],\n      [/\\*\\//, 'comment', '@pop'],\n      [/[/*]/, 'comment'],\n    ],\n    //Identical copy of comment above, except for the addition of .doc\n    doccomment: [\n      [/[^/*]+/, 'comment.doc'],\n      [/\\*\\//, 'comment.doc', '@pop'],\n      [/[/*]/, 'comment.doc'],\n    ],\n\n    string: [\n      [/[^\\\\\"]+/, 'string'],\n      [/@escapes/, 'string.escape'],\n      [/\\\\./, 'string.escape.invalid'],\n      [/\"/, 'string', '@pop'],\n    ],\n\n    raw: [\n      [\n        /(.*)(\\))(?:([^ ()\\\\\\t]*))(\")/,\n        {\n          cases: {\n            '$3==$S2': [\n              'string.raw',\n              'string.raw.end',\n              'string.raw.end',\n              { token: 'string.raw.end', next: '@pop' },\n            ],\n            '@default': [\n              'string.raw',\n              'string.raw',\n              'string.raw',\n              'string.raw',\n            ],\n          },\n        },\n      ],\n      [/.*/, 'string.raw'],\n    ],\n\n    include: [\n      [\n        /(\\s*)(<)([^<>]*)(>)/,\n        [\n          '',\n          'keyword.directive.include.begin',\n          'string.include.identifier',\n          { token: 'keyword.directive.include.end', next: '@pop' },\n        ],\n      ],\n      [\n        /(\\s*)(\")([^\"]*)(\")/,\n        [\n          '',\n          'keyword.directive.include.begin',\n          'string.include.identifier',\n          { token: 'keyword.directive.include.end', next: '@pop' },\n        ],\n      ],\n    ],\n  },\n} as ILanguage;\n","import React from 'react';\nimport { editorState } from '../../state';\n// import { editorContext } from '../../.';\nimport styles from './tabs.module.css';\nimport editorcss from '../../editor.module.css';\nimport { IoCloseOutline } from 'react-icons/io5';\nimport { useProxy } from 'valtio';\nimport { IoImageOutline } from 'react-icons/io5';\nimport { IoCubeOutline } from 'react-icons/io5';\nimport { checkIfModifications } from '../../editor';\n\nexport const EditorTabs = () => {\n  const snapshot = useProxy(editorState);\n  const setActive = (value: any) => {\n    if (editorState.obcMode || editorState.diffMode) {\n      editorState.activeMaterial.model = editorState.activeMaterial.cachedModel;\n      editorState.activeMaterial.cachedModel = null;\n      editorState.diffMode = false;\n      editorState.obcMode = false;\n      editorState.triggerUpdate++;\n    } else {\n      editorState.activeMaterial = value\n    }\n   \n    checkIfModifications();\n  };\n  const closeTab = (key: any) => {\n    delete editorState.tabs[key];\n    if (Object.keys(editorState.tabs).length === 0) {\n      editorState.obcMode = false;\n      editorState.diffMode = false;\n      editorState.triggerUpdate++;\n      return\n    }\n    let lastKey = Object.keys(editorState.tabs).pop()\n    if (lastKey) {\n      editorState.activeMaterial = editorState.tabs[lastKey]\n    }\n  };\n\n  return (\n    <div\n      className={`${styles.tabs} ${\n        snapshot.showEditor && snapshot.fullScreen ? styles.full : ''\n      }`}\n    >\n      {Object.entries(snapshot.tabs).map(([key, value]: any) => {\n        const name = value.model.replace('urn:', '')\n        return (\n          <div key={key}>\n            <div\n              className={\n                key === snapshot.activeMaterial.model\n                  ? styles.tactive\n                  : ''\n              }\n              onClick={() => {\n                setActive(value);\n              }}\n            >\n              {value.type === 'frag' ? (\n                <IoImageOutline className={editorcss.colorf} />\n              ) : (\n                <IoCubeOutline className={editorcss.colorv} />\n              )}{' '}\n              {`${name}`}{' '}\n              <IoCloseOutline onClick={() => closeTab(value.model)} />\n            </div>\n            {/* <div onClick={() => {value.opened = false; setActive('vert')}}>{`${name}.vert`}  <IoCloseOutline onClick={() => {value.opened = false;}}/></div> */}\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n","import { Material, ShaderLib } from 'three';\n\n// Copied from threejs WebGLPrograms.js so we can resolve builtin materials to their shaders\nconst MATERIAL_TYPES_TO_SHADERS: { [key: string]: string } = {\n  MeshDepthMaterial: 'depth',\n  MeshDistanceMaterial: 'distanceRGBA',\n  MeshNormalMaterial: 'normal',\n  MeshBasicMaterial: 'basic',\n  MeshLambertMaterial: 'lambert',\n  MeshPhongMaterial: 'phong',\n  MeshToonMaterial: 'toon',\n  MeshStandardMaterial: 'physical',\n  MeshPhysicalMaterial: 'physical',\n  MeshMatcapMaterial: 'matcap',\n  LineBasicMaterial: 'basic',\n  LineDashedMaterial: 'dashed',\n  PointsMaterial: 'points',\n  ShadowMaterial: 'shadow',\n  SpriteMaterial: 'sprite',\n};\n\nexport const getTypeForMaterial = (material: string) => {\n  let builtinType: string = MATERIAL_TYPES_TO_SHADERS[material];\n  return builtinType || (material === 'ShaderMaterial' ? 'shader' : 'unknown');\n};\n\nexport const getNameForEditorMaterial = (material: any, programGl: any) => {\n  let name = ''\n\n  if (material.isEffect) {\n    name = material.name.replace('Effect', '').toLowerCase()\n  } else {\n    name = getTypeForMaterial(programGl.name)\n  }\n  name = name + '_' + programGl.id;\n\n  return name;\n};\n\nexport const getShaderWithObc = (material: any) => {\n  let builtinType = MATERIAL_TYPES_TO_SHADERS[material.type];\n\n  const dummyShaderLib = Object.assign({}, ShaderLib[builtinType] ? ShaderLib[builtinType] : material)\n\n  if (ShaderLib[builtinType]) {\n    for (const [_key, value] of Object.entries(dummyShaderLib.uniforms)) {\n      const val:any = value\n      val.isNativeUniforms = true\n    }\n  }\n  \n  // TODO DEBUG UNIFORMS OF CUSTOM MATERIALS SHADER IS NOT SHOWING\n  if (!dummyShaderLib.obcAdded && !material.obcAdded) {\n    material.obcAdded = true;\n    dummyShaderLib.obcAdded = true;\n    material.onBeforeCompile.call(\n      material,\n      dummyShaderLib\n    );\n    dummyShaderLib.uniforms = Object.assign(dummyShaderLib.uniforms, material.uniforms);\n  }\n  return dummyShaderLib;\n};\n\nexport const getShaderLibForMaterial = (material: Material) => {\n  let builtinType = MATERIAL_TYPES_TO_SHADERS[material.type];\n\n  return builtinType ? ShaderLib[builtinType] : material;\n};\n","import React, { VFC } from 'react';\nimport { getNameForEditorMaterial } from '../../helpers/shaderToMaterial';\nimport { editorState } from '../../state';\nimport { useProxy } from 'valtio';\nimport { editorContext } from '../../.';\nimport editorcss from '../../editor.module.css';\nimport { checkIfModifications } from '../../editor';\n\nimport styles from './menu.module.css';\nimport { IoImageOutline } from 'react-icons/io5';\nimport { IoCubeOutline } from 'react-icons/io5';\n\ninterface LiMenuProps {\n  type: string;\n  program: any;\n}\n\nexport const LiMenu: VFC<LiMenuProps> = ({ type, program }) => {\n  const snapshot = useProxy(editorState);\n  const material = program.material;\n  const programGl = program.program;\n\n  const name = getNameForEditorMaterial(material, programGl)\n  const getModif = (type: string) => {\n    if (!editorContext.monacoRef) {\n      return;\n    }\n    const oModel = editorContext.monacoRef.editor.getModel(\n      `urn:${name}.${type}_orig`\n    );\n    const mModel = editorContext.monacoRef.editor.getModel(\n      `urn:${name}.${type}`\n    );\n    if (!oModel || !mModel) {\n      return null;\n    }\n    return oModel.getValue() !== mModel.getValue();\n  };\n  // TODO M DISPARAIT QUAND ON MINIMIZE L'EDITOR\n\n  return (\n    <li\n      className={`${\n        snapshot.tabs[`urn:${name}.${type}`] ? styles.open : ''\n      } + ' ' + ${\n        snapshot.activeMaterial &&\n        snapshot.activeMaterial.model === `urn:${name}.${type}`\n          ? styles.mactive\n          : ''\n      }`}\n      onClick={() => {\n        const value = {\n          type,\n          open: true,\n          cachedModel: `urn:${name}.${type}`,\n          isModif: false,\n          model: `urn:${name}.${type}`\n        };\n        editorState.activeMaterial = value;\n        editorContext.activeMaterialRef[value.model] = program;\n        editorState.tabs[`urn:${name}.${type}`] = value;\n\n        editorState.showUniforms = true\n\n        editorState.showEditor = true;\n        editorState.diffMode = false;\n        editorState.obcMode = false;\n        editorState.triggerUpdate++;\n        checkIfModifications();\n      }}\n    >\n      {type === 'frag' ? (\n        <IoImageOutline className={editorcss.colorf} />\n      ) : (\n        <IoCubeOutline className={editorcss.colorv} />\n      )}{' '}\n      {name}.{type}{' '}\n      {getModif(type) && <span className={styles.isModif}>M</span>}\n    </li>\n  );\n};\n","import React, { useState, VFC } from 'react';\nimport { getNameForEditorMaterial } from '../../helpers/shaderToMaterial';\nimport { editorState } from '../../state';\nimport { useProxy } from 'valtio';\n\nimport { IoEyeOutline } from 'react-icons/io5';\nimport { IoEyeOffOutline } from 'react-icons/io5';\nimport { RiArrowDownSFill } from 'react-icons/ri';\nimport { RiArrowRightSFill } from 'react-icons/ri';\nimport styles from './menu.module.css';\nimport { IoCubeOutline } from 'react-icons/io5';\nimport { VscSettings } from 'react-icons/vsc';\nimport { editorContext } from '../../.';\n\nimport { LiMenu } from './menuLi';\n\ninterface SubMenuProps {\n  program: any;\n}\n\nexport const SubMenu: VFC<SubMenuProps> = ({ program }) => {\n  const snapshot = useProxy(editorState);\n  const [open, set] = useState(true);\n  const material = program.material;\n  const programGl = program.program;\n  if (!programGl) {\n    return null\n  }\n  const name = getNameForEditorMaterial(material, programGl)\n\n  const hide = (e: any) => {\n    e.stopPropagation();\n    \n    // TODO PP LIBS renderToScreen or pass.enabled\n    material.visible = !material.visible;\n    material.enabled = !material.enabled;\n    material.needsUpdate = true;\n    editorState.triggerUpdate++;\n  };\n\n  const showUniforms = (e: any) => {\n    e.stopPropagation();\n\n    const value = {\n      type: '',\n      open: true,\n      isModif: false,\n      model: `urn:${name}`\n    };\n  \n    editorState.activeMaterial = value;\n    editorContext.activeMaterialRef[value.model] = program;\n    \n    editorState.showEditor = false;\n    editorState.diffMode = false;\n    editorState.obcMode = false;\n    editorState.showUniforms = true\n    editorState.triggerUpdate++;\n  };\n\n  return programGl && material ? (\n    <div key={snapshot.triggerUpdate} className={open ? styles.sbopen : ''}>\n      <div\n        className={`${styles.hmenu} ${\n          snapshot.tabs[`urn:${name}.frag`] || snapshot.tabs[`urn:${name}.vert`]\n            ? styles.open\n            : ''\n        }`}\n        onClick={showUniforms}\n      >\n        {open ? <RiArrowDownSFill  onClick={() => {\n          set(!open);\n        }} /> : <RiArrowRightSFill onClick={() => {\n          set(!open);\n        }} />} {name}\n        {material && material.numberOfMaterialsUser > 1 && (\n          <span className={styles.multiusers}>\n            <IoCubeOutline />\n            <small>{material.numberOfMaterialsUser}</small>\n          </span>\n        )}\n        <VscSettings className={styles.unibtn} />\n        {(material && !material.visible && !material.isEffect ? (\n          <IoEyeOffOutline onClick={hide} className={styles.eye} />\n        ) : (\n          <IoEyeOutline onClick={hide} className={styles.eye} />\n        ))}\n      </div>\n      {open && (\n        <ul>\n          {material.fragmentShader && <LiMenu program={program} type={'frag'} />}\n          {material.vertexShader && <LiMenu program={program} type={'vert'} />}\n        </ul>\n      )}\n    </div>\n  ) : null;\n};","import React from 'react';\nimport { editorState } from '../../state';\nimport { useProxy } from 'valtio';\n\nimport { AiOutlineFullscreen } from 'react-icons/ai';\nimport { BiDockRight } from 'react-icons/bi';\nimport { BsArrowBarRight } from 'react-icons/bs';\nimport { BsArrowBarLeft } from 'react-icons/bs';\nimport styles from './menu.module.css';\n\nexport const HeadMenu = () => {\n  const snapshot = useProxy(editorState);\n\n  return (\n    <div key={snapshot.triggerUpdate} className={styles.mhead}>\n      {editorState.showEditor && editorState.fullScreen && (\n        <BiDockRight\n          onClick={() => {\n            editorState.fullScreen = false;\n          }}\n        />\n      )}\n      {editorState.showEditor && !editorState.fullScreen && (\n        <AiOutlineFullscreen\n          onClick={() => {\n            editorState.fullScreen = true;\n          }}\n        />\n      )}\n      <div\n        onClick={() => {\n          editorState.showEditor = !editorState.showEditor;\n          editorState.diffMode = false;\n        }}\n      >\n        {snapshot.showEditor ? <BsArrowBarRight /> : <BsArrowBarLeft />}\n      </div>\n    </div>\n  );\n};\n","import React from 'react';\nimport { editorState } from '../../state';\nimport { useProxy } from 'valtio';\n\nimport { getNameForEditorMaterial } from '../../helpers/shaderToMaterial';\n\nimport { AiOutlineFunction } from 'react-icons/ai';\nimport { VscCompareChanges } from 'react-icons/vsc';\nimport { HiOutlineClipboardCopy } from 'react-icons/hi';\nimport { BiEraser } from 'react-icons/bi';\n\nimport styles from './menu.module.css';\nimport { editorContextState as editorContext } from '../../state';\n\n\nexport const BottomAction = () => {\n  const snapshot = useProxy(editorState);\n  let isShader = false;\n  if (!editorContext.monacoRef || !editorState.activeMaterial.model) {\n    return null;\n  }\n  let activeMat = editorContext.activeMaterialRef[editorState.activeMaterial.model]\n  if ( activeMat && activeMat.material) {\n    isShader = activeMat.material.type === ('ShaderMaterial' || 'RawShaderMaterial');\n  }\n\n  if (editorState.obcMode && editorState.activeMaterial.cachedModel) {\n    activeMat = editorContext.activeMaterialRef[editorState.activeMaterial.cachedModel]\n  }\n  \n  if (!activeMat) {\n    return null\n  }\n  const material: any = activeMat.material;\n\n  const cancelChange = () => {\n    const type = editorState.activeMaterial.type;\n    const program: any = activeMat.program;\n    const name = getNameForEditorMaterial(material, program)\n\n    const oModel = editorContext.monacoRef.editor.getModel(\n      `urn:${name}.${type}_orig`\n    );\n    const model = editorContext.monacoRef.editor.getModel(\n      `urn:${name}.${type}`\n    );\n    if (model) {\n      model.setValue(oModel.getValue());\n    }\n    editorState.activeMaterial.isModif = false;\n  };\n\n  const openObcMode = () => {\n    editorState.activeMaterial.cachedModel = editorState.activeMaterial.model + '';\n    setTimeout(() => {\n      editorState.activeMaterial.model = 'urn:obc_result';\n      editorState.showEditor = true;\n      editorState.diffMode = false;\n      editorState.obcMode = true;\n    }, 0);\n  };\n  const closeObcMode = () => {\n    editorState.activeMaterial.model = editorState.activeMaterial.cachedModel;\n    editorState.activeMaterial.cachedModel = null;\n    editorState.diffMode = false;\n    editorState.obcMode = false;\n    editorState.triggerUpdate++;\n  };\n  return snapshot.activeMaterial && snapshot.activeMaterial.isModif && snapshot.showEditor && material ? (\n    <div key={snapshot.triggerUpdate} className={styles.menub}>\n      {snapshot.obcMode && (\n        <div\n          className={`${styles.menubaction}`}\n          onClick={() => {\n            editorContext.editor.trigger(\n              'source',\n              'editor.action.clipboardCopyAction'\n            );\n          }}\n        >\n          <HiOutlineClipboardCopy /> Copy\n        </div>\n      )}\n      {!snapshot.diffMode && !snapshot.obcMode && (\n        <div\n          className={styles.menubaction}\n          onClick={() => {\n            editorState.diffMode = true;\n          }}\n        >\n          <VscCompareChanges /> Analyze diff\n        </div>\n      )}\n      {snapshot.diffMode && !snapshot.obcMode && (\n        <div\n          className={`${styles.menubaction} ${styles.closemenubaction}`}\n          onClick={() => {\n            editorState.diffMode = false;\n          }}\n        >\n          <VscCompareChanges /> Close diff\n        </div>\n      )}\n      {!isShader && !snapshot.diffMode && !snapshot.obcMode && material && !material.isEffect && (\n        <div\n          className={styles.menubaction}\n          onClick={() => {\n            openObcMode();\n          }}\n        >\n          <AiOutlineFunction /> onBeforeCompile\n        </div>\n      )}\n      {!isShader && snapshot.obcMode && material && !material.isEffect && (\n        <div\n          className={`${styles.menubaction} ${styles.closemenubaction}`}\n          onClick={() => {\n            closeObcMode();\n          }}\n        >\n          <AiOutlineFunction /> onBeforeCompile\n        </div>\n      )}\n      {!snapshot.obcMode && !snapshot.diffMode && (\n        <div\n          className={`${styles.menubaction} ${styles.closemenubaction} ${styles.resetmenub}`}\n          onClick={cancelChange}\n        >\n          <BiEraser /> Reset shader\n        </div>\n      )}\n    </div>\n  ) : null;\n};","\n\nimport React, { useEffect, VFC } from 'react';\nimport { editorContextState as editorContext, editorState } from '../../state';\nimport { Leva, LevaPanel, useControls, useCreateStore } from \"leva\";\nimport { useProxy } from 'valtio';\nimport * as THREE from 'three'\n\n// import styles from './menu.module.css';\n\ninterface UniformsMenuProps {\n}\n\n// foreach\nconst color = new THREE.Color()\nexport const UniformsMenu: VFC<UniformsMenuProps> = () => {\n  const snapshot = useProxy(editorState);\n  const [store, setSelection]:any = React.useState(null)\n  if (!editorContext.monacoRef) {\n    return null;\n  }\n\n  if (!editorContext.activeMaterialRef || !editorState.activeMaterial.model) {\n    return null;\n  }\n  const activeMat = editorContext.activeMaterialRef[editorState.activeMaterial.model]\n\n  if (!activeMat) {\n    return null\n  }\n  const material: any = activeMat.material;\n\n\n  if (!editorState.showUniforms || !material.uniforms) {\n    return null\n  }\n\n  const filteredItems:any = {}\n\n\n  if (material.uniforms.size && material.uniforms.size > 0) {\n    material.uniforms.forEach((uniform: any, key: any) => {\n      if (!uniform.isNativeUniforms && key !== 'time') {\n        if (typeof uniform.value === 'number') {\n          uniform.min = -1\n          uniform.max = 1\n        }\n        if (uniform.type) {\n          delete uniform.type\n        }\n\n        if (uniform && uniform.value && uniform.value.image) {\n          filteredItems[key] = {image: uniform.value}\n          uniform.copyRef = uniform.value.image.currentSrc\n        } else if (uniform.value && uniform.value.isColor) {\n          const col = uniform.value\n          filteredItems[key] = {r: col.r * 255, g: col.g * 255, b: col.b * 255}\n        } else {\n          filteredItems[key] = uniform\n        }\n        material.uniforms.set(key, uniform)\n        Object.entries(filteredItems[key]).map(([skey, value]) => {\n          if (typeof value === 'string') {\n            delete filteredItems[key][skey]\n          }\n        })\n      }\n    })\n  } else if (typeof material.uniforms === 'object') {\n    if (Object.keys(material.uniforms).length === 0) {\n      return null\n    }\n    Object.entries(material.uniforms).map(([key, uniform]: any) => {\n      if (!uniform.isNativeUniforms && key !== 'time') {\n        if (typeof uniform.value === 'number') {\n          uniform.min = Math.min(-1, -Math.round(uniform.value))\n          uniform.max = Math.max(1, Math.round(uniform.value))\n        }\n        if (uniform.type) {\n          delete uniform.type\n        }\n        if (uniform && uniform.value && uniform.value.image) {\n          filteredItems[key] = {image: uniform.value}\n          uniform.copyRef = uniform.value.image.currentSrc\n\n        } else if (uniform.value && uniform.value.isColor) {\n          const col = uniform.value\n          filteredItems[key] = {r: col.r * 255, g: col.g * 255, b: col.b * 255}\n        } else {\n          filteredItems[key] = uniform\n        }\n\n        Object.entries(filteredItems[key]).map(([skey, value]) => {\n          if (typeof value === 'string') {\n            delete filteredItems[key][skey]\n          }\n        })\n      }\n    })\n  }\n\n\n\n  return (\n    <div>\n      <Leva fill={true} flat={true} hideTitleBar oneLineLabels={false} />\n      <LevaPanel fill={true} flat={true}  hideTitleBar={true} store={store} oneLineLabels={false} />\n      {/* <LevaPanel store={store} oneLineLabels={false} /> */}\n      <div key={snapshot.triggerUpdate}>\n        <UniformComp filteredItems={filteredItems} setSelection={setSelection} uniforms={material.uniforms} store={store} />\n      </div>\n    </div>\n  )\n};\n\n\n\n\nconst loadTexture = (uniforms: any, materialUniform: any, key: string, value: any) => {\n\n  if (materialUniform && materialUniform.value && materialUniform.value.image) {\n    if (value && value !== materialUniform.value.image.preventDouble) {\n      new THREE.TextureLoader().load(value, (x) => {\n        materialUniform.value = x\n        materialUniform.value.wrapS = materialUniform.value.wrapT = THREE.RepeatWrapping\n\n        materialUniform.value.image.preventDouble = value\n        materialUniform.value.image.isOriginal = false\n        materialUniform.value.needsUpdate = true\n        setUniformValue(uniforms, materialUniform, key)\n\n      })\n    } else if (!value && !materialUniform.value.image.isOriginal) {\n      new THREE.TextureLoader().load(materialUniform.copyRef, (x) => {\n        materialUniform.value = x\n        materialUniform.value.wrapS = materialUniform.value.wrapT = THREE.RepeatWrapping\n\n        materialUniform.value.image.preventDouble = value\n        materialUniform.value.image.isOriginal = true\n        materialUniform.value.needsUpdate = true\n        setUniformValue(uniforms, materialUniform, key)\n      })\n    }\n  }\n \n}\nconst UniformComp = ({filteredItems, uniforms, setSelection} :any) => {\n  const store = useCreateStore()\n  const [elements] = useControls(() => (filteredItems), { store })\n\n\n  useEffect(() => {\n    for (const [key, value] of Object.entries(elements)) {\n      const val:any = value\n      var materialUniform = uniforms[key] || uniforms.get(key)\n\n      // is image\n      if (typeof value === 'string' || !value) {\n        loadTexture(uniforms, materialUniform, key, value)\n      } else {\n\n        if (materialUniform) {\n          if (val['r'] && val['g'] && val['b']) {\n            const factor =  255\n            materialUniform.value = color.setRGB(val['r'] / factor, val['g'] / factor, val['b'] / factor)\n            setUniformValue(uniforms, materialUniform, key)\n\n          } else {\n            materialUniform.value = value\n            setUniformValue(uniforms, materialUniform, key)\n          }\n        }\n      }\n    }\n  }, [elements])\n\n  useEffect(() => {\n    setSelection(store)\n  }, [store, setSelection])\n\n  return null\n}\n\nconst setUniformValue = (uniforms: any, materialUniform: any, key: string) => {\n  if (!uniforms[key]) {\n    uniforms.set(key, materialUniform)\n  }\n}","import React from 'react';\nimport { editorContext } from '../../.';\nimport { editorState } from '../../state';\nimport { useProxy } from 'valtio';\n\nimport { useDrag } from 'react-use-gesture';\nimport styles from './menu.module.css';\nimport { SubMenu } from './menuSub';\nimport { HeadMenu } from './menuHead';\nimport { BottomAction } from './menuActions';\nimport { UniformsMenu } from './menuUniforms';\n\nexport const Menu = () => {\n  const snapshot = useProxy(editorState);\n  let editorWidth = editorContext.editorWidth;\n  let editorHeight = editorContext.editorMinusHeight;\n  const menuSize = 160\n\n  const bind = useDrag(({ down, delta: [mx, my] }) => {\n    if (editorState.fullScreen) {\n      return;\n    }\n    if (down && typeof window !== 'undefined') {\n      editorWidth -= editorWidth - mx > window.innerWidth - menuSize ? 0 : mx\n      editorHeight -= editorHeight - my < 0 ? 0 : my\n\n      editorContext.dom.current.style.setProperty(\n        '--editor-width', editorWidth + 'px'\n      );\n      editorContext.dom.current.style.setProperty(\n        '--editor-minus-height', editorHeight + 'px'\n      );\n    } else {\n      if (typeof window !== 'undefined') {\n        if (window.innerWidth - editorWidth < 200) { editorWidth = window.innerWidth - menuSize}\n        if (editorHeight < 40) { editorHeight = 0}\n        editorContext.dom.current.style.setProperty(\n          '--editor-width', editorWidth + 'px'\n        );\n        editorContext.dom.current.style.setProperty(\n          '--editor-minus-height', editorHeight + 'px'\n        );\n      }\n      editorContext.editorWidth = editorWidth;\n      editorContext.editorMinusHeight = editorHeight;\n    }\n  });\n  return editorContext.programs.length > 0 ? (\n    <div\n      className={`${styles.menu} ${!snapshot.showEditor ? styles.menurh : ''} ${\n        snapshot.showEditor && snapshot.fullScreen ? styles.full : ''\n      }`}\n      {...bind()}\n      style={{ touchAction: 'none' }}\n    >\n      <HeadMenu />\n      <div key={snapshot.triggerUpdate} className={styles.menulist}>\n        {editorContext.programs.map((value: any, key: any) => {\n          return <SubMenu program={value} key={key.toString()} />;\n        })}\n      </div>\n      <UniformsMenu />\n      <BottomAction />\n    </div>\n  ) : null;\n};\n","import React, { useEffect, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport { useProxy } from 'valtio';\nimport styles from './editor.module.css';\nimport { editorContextState, editorState } from './state';\n\nexport const FullScreen = () => {\n  const snapshot = useProxy(editorState);\n  const embed = useRef<any>(null);\n  const div = document.createElement('div');\n  div.style.position = 'absolute';\n  div.style.left = '0';\n  div.style.right = '0';\n  div.style.bottom = '0';\n  div.style.top = '0';\n  const [el] = useState(() => div);\n  const element = editorContextState.gl.domElement;\n\n  useEffect(() => {\n    if (el && embed.current) {\n      document.body.appendChild(el);\n\n      el.appendChild(element);\n      embed.current.appendChild(editorContextState.gl.domElement);\n      return () => {\n        // if (el) document.body.removeChild(el);\n        // unmountComponentAtNode(el);\n      };\n    }\n    return undefined;\n  }, [el, element]);\n\n  // use drag https://codesandbox.io/s/rkgzi?file=/src/index.js\n  return createPortal(\n    <div\n      ref={embed}\n      className={`${styles.embed} ${\n        !snapshot.diffMode && snapshot.fullScreen && snapshot.showEditor\n          ? styles.embedfull\n          : ''\n      }`}\n    >\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"54\"\n        height=\"14\"\n        viewBox=\"0 0 54 14\"\n      >\n        <g fill=\"none\" fillRule=\"evenodd\" transform=\"translate(1 1)\">\n          <circle\n            cx=\"6\"\n            cy=\"6\"\n            r=\"6\"\n            fill=\"#FF5F56\"\n            stroke=\"#E0443E\"\n            strokeWidth=\".5\"\n          ></circle>\n          <circle\n            cx=\"26\"\n            cy=\"6\"\n            r=\"6\"\n            fill=\"#FFBD2E\"\n            stroke=\"#DEA123\"\n            strokeWidth=\".5\"\n          ></circle>\n          <circle\n            cx=\"46\"\n            cy=\"6\"\n            r=\"6\"\n            fill=\"#27C93F\"\n            stroke=\"#1AAB29\"\n            strokeWidth=\".5\"\n          ></circle>\n        </g>\n      </svg>\n      <div className={styles.embedglass}></div>\n    </div>,\n    el\n  );\n};\n","import React, { FC, VFC, useEffect, useState, useRef, useLayoutEffect } from 'react';\nimport styles from './editor.module.css';\nimport { editorContextState, editorState } from './state';\nimport { editorContext } from '.';\nimport { useProxy } from 'valtio';\nimport { replaceShaderChunks, generateOBc } from './helpers/formatter';\n\nimport Editor, { DiffEditor, loader } from '@monaco-editor/react';\nimport * as shaderLanguage from './cshader';\nimport { EditorTabs } from './components/tabs/tabs';\nimport { Menu } from './components/menu/menu';\nimport { FullScreen } from './fullscreen';\nimport { getNameForEditorMaterial } from './helpers/shaderToMaterial';\nimport Monokai from './helpers/themes/Monokai.json';\n\n// const epoch = Date.now();\n\nexport const checkIfModifications = () => {\n  const oModel = editorContext.monacoRef.editor.getModel(\n    editorState.activeMaterial.model + '_orig'\n  );\n  const mModel = editorContext.monacoRef.editor.getModel(\n    editorState.activeMaterial.model\n  );\n  if (oModel && mModel) {\n    var origin = oModel.getValue();\n    var modif = mModel.getValue();\n  }\n  editorState.activeMaterial.isModif = origin !== modif;\n};\nexport const updateActiveShader = (value: any, type: string) => {\n  if (!editorState.activeMaterial.model) {\n    return\n  }\n  const activeMat = editorContext.activeMaterialRef[editorState.activeMaterial.model]\n  const material: any = activeMat.material;\n\n  editorContext.monacoRef.editor.setModelMarkers(\n    editorContext.editor.getModel(),\n    editorState.activeMaterial.model,\n    value\n  );\n  if (material) {\n    if (material.isEffect) {\n      material.vertexShader = type === 'vert' ? value : material.vertexShader;\n      material.fragmentShader = type === 'frag' ? value : material.fragmentShader;\n      activeMat.effect.recompile(editorContext.gl)\n    } else {\n      material.editorOnBeforeCompile = (shader: any) => {\n        shader.vertexShader = type === 'vert' ? value : material.vertexShader;\n        shader.fragmentShader = type === 'frag' ? value : material.fragmentShader;\n      };\n    }\n \n\n    checkIfModifications();\n    // if (type === 'vert') {\n    //   material.setOption({\n    //     vertexMainOutro: value\n    //   })\n    // } else if (type === 'frag') {\n    //   material.setOption({\n    //     fragmentColorTransform: value\n    //   })\n\n    material.needsUpdate = true;\n    editorState.triggerUpdate++;\n    material.customProgramCacheKey = () => {\n      return editorState.triggerUpdate\n    };\n  }\n};\n\nexport const MaterialEditor: FC = () => {\n  const [instanceReady, setinstanceReady] = useState(false)\n  useLayoutEffect(() => {\n    if (typeof window !== \"undefined\" && !editorContext.monacoRef) {\n      loader\n        .init()\n        .then(monacoInstance => {\n          editorContext.monacoRef = monacoInstance;\n          editorContext.monacoRef.editor.defineTheme('monokai', Monokai);\n          setinstanceReady(true)\n          monacoInstance.languages.register({ id: 'cshader' });\n          monacoInstance.languages.setLanguageConfiguration(\n            'cshader',\n            shaderLanguage.conf\n          );\n          monacoInstance.languages.setMonarchTokensProvider(\n            'cshader',\n            shaderLanguage.language\n          );\n        })\n        .catch(error =>\n          console.error('An error occurred during initialization of Monaco: ', error)\n        );\n    }\n    \n  })\n\n  return <>{instanceReady && <EditorDom />}</>;\n};\n\nconst handleEditorValidation = () => {\n  const diagnostics: any = editorState.diagnostics;\n  if (!editorState.activeMaterial.model) {\n    return\n  }\n  const material: any = editorContext.activeMaterialRef[editorState.activeMaterial.model].material;\n  if (diagnostics && diagnostics.fragmentShader && !diagnostics.runnable && editorContext.monacoRef) {\n    const error =\n      diagnostics.fragmentShader.log === ''\n        ? diagnostics.vertexShader\n        : diagnostics.fragmentShader;\n    const errs: string[] = error.log.split('\\n');\n    // to count the margin\n    const prefix: string[] = error.prefix.split('\\n');\n\n    errs.pop();\n    let errorfromEffectAdjust = 0\n    const markets = errs.map(err => {\n      if (material && material.isEffect && editorContext.editor) {\n        const type = editorState.activeMaterial.type;\n\n        const getVoidEffectLine = type === 'frag' ? `e${material.id}MainImage` : `e${material.id}MainUv`\n        const fullProg = type === 'frag' ? diagnostics.frag : diagnostics.vert\n        const progArr: string[] = fullProg.split('\\n');\n        errorfromEffectAdjust = progArr.findIndex((el) => {\n         return el.includes(getVoidEffectLine)\n        })\n        const model = editorContext.editor.getModel()\n        if (model) {\n          const editorTxtArr: string[] = model.getValue().split('\\n');\n          const getVoidEditorLine = type === 'frag' ? `mainImage` : `mainUv`\n          const adjustUniforms = editorTxtArr.findIndex((el) => {\n            return el.includes(getVoidEditorLine)\n          })\n          errorfromEffectAdjust -= adjustUniforms\n        }\n      }\n\n      const re = new RegExp('[^0-9]+ ([0-9]+):([0-9]+):');\n      const rl: any = err.match(re) || [];\n\n      const message = err.split(':');\n      message[2] = (parseInt(message[2]) - (material.isEffect ? errorfromEffectAdjust : prefix.length) || '').toString();\n\n      const pos = parseInt(rl[1] || 1);\n      const lin = parseInt(rl[2] || 1) - (material.isEffect ? errorfromEffectAdjust : prefix.length);\n      return {\n        startLineNumber: lin,\n        startColumn: pos,\n        endLineNumber: lin,\n        endColumn: 1000,\n        message: message.join(':'),\n        severity: editorContext.monacoRef.MarkerSeverity.Error,\n      };\n    });\n    editorContext.monacoRef.editor.setModelMarkers(\n      editorContext.editor.getModel(),\n      editorState.activeMaterial.model,\n      markets\n    );\n  }\n};\nexport const HandleError = () => {\n  const snapshot = useProxy(editorState);\n\n  useEffect(() => {\n    // const diagnostics: any = snapshot.diagnostics\n    // if (diagnostics && diagnostics.fragmentShader && !diagnostics.runnable) {\n    handleEditorValidation();\n    // }\n  }, [snapshot.diagnostics]);\n  return null;\n};\n\nconst EditorDom = () => {\n  const dom = useRef(null);\n  const snapshot = useProxy(editorState);\n  editorContext.dom = dom;\n\n  return (\n    <div\n      ref={dom}\n      className={`${styles.editor_c} ${\n        snapshot.showEditor ? '' : styles.editor_h\n      } ${snapshot.showEditor && snapshot.fullScreen ? styles.full : ''} ${\n        editorState.className\n      }`}\n    >\n      <Menu />\n      {editorContextState.gl && <FullScreen />}\n      {snapshot.showEditor && <EditorText />}\n    </div>\n  );\n};\n\nconst EditorEdit = () => {\n  const snapshot = useProxy(editorState);\n  const [isEditorReady, setIsEditorReady] = useState(false);\n\n  function handleEditorDidMount(editor: any, _: any) {\n    editorContext.editor = editor;\n    setIsEditorReady(true);\n  }\n\n  useEffect(() => {\n    // at initialization of any new active material set the 2 models\n    if (editorState.activeMaterial && editorContext.activeMaterialRef && editorContext.monacoRef && editorState.activeMaterial.model) {\n      const type = editorState.activeMaterial.type;\n      const activeMat = editorContext.activeMaterialRef[editorState.activeMaterial.model]\n      if (!activeMat) {\n        return\n      }\n      const material: any = activeMat.material;\n      const program: any = activeMat.program;\n\n      if (isEditorReady && material) {\n        const name = getNameForEditorMaterial(material, program)\n\n        let textContent: string | undefined;\n        if (type === 'frag') {\n          textContent = replaceShaderChunks(material.fragmentShader);\n        } else {\n          textContent = replaceShaderChunks(material.vertexShader);\n        }\n\n        if (\n          !editorContext.monacoRef.editor.getModel(`urn:${name}.${type}_orig`)\n        ) {\n          editorContext.monacoRef.editor.createModel(\n            textContent,\n            'cshader',\n            `urn:${name}.${type}_orig`\n          );\n          // TODO ADD OPTION\n          if (material.type !== 'ShaderMaterial' && material.type !== 'RawShaderMaterial' && !material.isEffect) {\n            editorContext.editor.trigger('fold', 'editor.foldLevel1');\n          }\n        }\n      }\n    }\n  }, [isEditorReady, snapshot.activeMaterial, editorContext.monacoRef]);\n\n  const getText = () => {\n    if (!editorState.activeMaterial.model) {\n      return ''\n    }\n    let textContent: string | undefined;\n    const type = editorState.activeMaterial.type;\n    const model = editorState.activeMaterial.model;\n    const activeMat = editorContext.activeMaterialRef[editorState.activeMaterial.model];\n    if (activeMat) {\n      const program = activeMat.program;\n      const material: any = activeMat.material;\n  \n      if (type === 'frag') {\n        textContent = replaceShaderChunks(material ? material.fragmentShader : program.fragmentShader);\n      } else if (type === 'vert') {\n        textContent = replaceShaderChunks(material ? material.vertexShader : program.vertexShader);\n      }\n    }\n\n    if (model === 'urn:obc_result' && editorState.obcMode) {\n      const result = generateOBc(textContent)\n      if (editorContext.monacoRef.editor.getModel('urn:obc_result')) {\n\n        editorContext.monacoRef.editor.getModel('urn:obc_result').setValue(result)\n      }\n      return result;\n    }\n\n    return textContent;\n  };\n\n  return (\n    <Editor\n      className={styles.editor}\n      language=\"cshader\"\n      theme={'vs-dark'}\n      onMount={handleEditorDidMount}\n      height={'100%'}\n      keepCurrentModel={true}\n      path={snapshot.activeMaterial.model + ''}\n      defaultLanguage={\n        snapshot.activeMaterial.model === 'urn:obc_result'\n          ? 'javascript'\n          : 'cshader'\n      }\n      defaultValue={getText()}\n      onChange={frag => {\n        if (editorState.obcMode) {\n          return false;\n        }\n        updateActiveShader(frag, snapshot.activeMaterial.type);\n        return false;\n      }}\n      // onValidate={handleEditorValidation}\n      options={{\n        formatOnType: true,\n        foldingHighlight: false,\n        folding: true,\n        foldingStrategy: 'auto'\n      }}\n    />\n  );\n};\n\nconst GetDiff = () => {\n  const model: any = editorState.activeMaterial.model;\n  const [isEditorReady, setIsEditorReady] = useState(false);\n\n  function handleEditorDidMount(editor: any, _: any) {\n    editorContext.diffEditor = editor;\n    setIsEditorReady(true);\n  }\n\n  var originalModel = editorContext.monacoRef.editor.getModel(model + '_orig');\n  var modifiedModel = editorContext.monacoRef.editor.getModel(model);\n\n  useEffect(() => {\n    if (isEditorReady) {\n      if (!editorContext.monacoRef.editor.getModel('diff_1')) {\n        editorContext.monacoRef.editor.createModel(\n          originalModel.getValue(),\n          'cshader',\n          `diff_1`\n        );\n      }\n      if (!editorContext.monacoRef.editor.getModel('diff_2')) {\n        editorContext.monacoRef.editor.createModel(\n          modifiedModel.getValue(),\n          'cshader',\n          `diff_2`\n        );\n      }\n      editorContext.diffEditor.setModel({\n        original: editorContext.monacoRef.editor.getModel('diff_1'),\n        modified: editorContext.monacoRef.editor.getModel('diff_2'),\n      });\n\n    \n    }\n    return () => {\n      if (\n        editorContext.editor.getModel() &&\n        editorContext.diffEditor.getModel().modified.getValue()\n      ) {\n        // send the update in the diff to the basic text editor\n        editorContext.monacoRef.editor\n          .getModel(editorState.activeMaterial.model)\n          .setValue(editorContext.diffEditor.getModel().modified.getValue());\n      }\n      var navi = editorContext.monacoRef.editor.createDiffNavigator(editorContext.diffEditor, {\n        followsCaret: true, // resets the navigator state when the user selects something in the editor\n        ignoreCharChanges: true // jump from line to line\n      });\n      navi.next()\n    };\n    \n  }, [isEditorReady, modifiedModel, originalModel]);\n\n  return (\n    <DiffEditor\n      className={styles.editor}\n      onMount={handleEditorDidMount}\n      theme={'vs-dark'}\n      height={'100%'}\n      options={{\n        formatOnType: true,\n      }}\n    />\n  );\n};\nconst EditorText: VFC = () => {\n  const snapshot = useProxy(editorState);\n  // implement multi-tab for vertex and frag using createModel\n  return snapshot.showEditor ? (\n    <>\n      {snapshot.activeMaterial.type && (\n        <>\n          <HandleError />\n          <EditorTabs />\n        </>\n      )}\n\n      {Object.keys(snapshot.tabs).length > 0 && <EditorEdit />}\n      {snapshot.showEditor &&\n        snapshot.diffMode &&\n        snapshot.activeMaterial.type && <GetDiff />}\n    </>\n  ) : null;\n};\n\nexport default MaterialEditor;\n","import {\n  getShaderWithObc,\n} from './shaderToMaterial';\nimport * as THREE from 'three'\nimport { editorContextState } from '../state';\n\nexport const addShaderDebugMaterial = (material: any) => {\n  let newMaterial = material;\n  const shader = getShaderWithObc(newMaterial)\n  newMaterial = Object.assign(newMaterial, shader);\n\n  const epoch = Date.now();\n\n  const canvas = editorContextState.gl.domElement;\n  const res = new THREE.Vector2(canvas.clientWidth, canvas.clientHeight)\n  // add a uniform time helper for animations\n  // if (!newMaterial.uniforms.time) {\n  //   newMaterial.uniforms.time = {\n  //     value: 0.0\n  //   }\n  // }\n\n  // wait the first compilation that will inject data into the material shaders\n  setTimeout(() => {\n    newMaterial.onBeforeCompile = function (shader: any) {\n      // troika break if we attribute uniforms\n        // sometimes we lose the uniforms ?\n        // if (!newMaterial.editorAttributeUniforms) {\n        //   newMaterial.editorAttributeUniforms = true\n      if (!newMaterial.postprocess) {\n        shader.uniforms = Object.assign(shader.uniforms, newMaterial.uniforms);\n      }\n        // }\n      // @ts-ignore\n      if (this.editorOnBeforeCompile) {\n        // @ts-ignore\n        this.editorOnBeforeCompile.call(this, shader)\n      }\n      // } else {\n        // override with the editor\n      //   shader.vertexShader = shader.vertexShader;\n      //   shader.fragmentShader = shader.fragmentShader;\n      // }\n  \n      // if time detected in obc or material, automatically update the value\n      if (shader.uniforms.time && !newMaterial.postprocess) {\n        shader.uniforms.time = {\n          writable: true,\n          configurable: true,\n          // @ts-ignore\n          get value() {\n            return (Date.now() - epoch) / 1000;\n          },\n        };\n      }\n      // helper for resolution\n      if (shader.uniforms.resolution) {\n        shader.uniforms.resolution = {\n          writable: true,\n          configurable: true,\n          // @ts-ignore\n          get value() {\n            return res\n          },\n        };\n      }\n    };\n  }, 0);\n  return {\n    debug: null,\n    material: newMaterial,\n  };\n};\n","import { Color, FrontSide, Mesh, MeshBasicMaterial, Scene } from 'three';\nimport { addShaderDebugMaterial } from './helpers/improveMaterial';\nimport { editorState, editorContextState } from './state';\n\nconst getMUIIndex = (muid: string) => muid === 'muidEditor';\n\nconst isAlreadyDerived: any = {};\nconst nativePPisAlreadyDerived: any = [];\n\nlet hasInit = false\n\n\nconst _insertMaterialToEditor = (element: any, container: any, isEffect?: boolean) => {\n  const el = isEffect ? element.screen : element\n  if (!el.material.defines) {\n    el.material.defines = {};\n  }\n\n  if (!el.material.defines.muidEditor) {\n    el.material.defines = Object.assign(el.material.defines || {}, {\n      muidEditor: el.material.id\n    });\n   \n  }\n  const muid = el.material.id;\n  // prevent to derive loop\n  if (\n    muid &&\n    !container[muid] &&\n    el.material.defines\n  ) {\n    const { material } = addShaderDebugMaterial(el.material);\n    el.material = material;\n\n    // to check if multiple material users\n    el.tmeDerived = true;\n    el.material.numberOfMaterialsUser = 1\n    container[muid] = el.material;\n    container[muid].mesh = el;\n    // handle postprocess and react-postprocess libs\n    if (element.effects) {\n      let id = 0\n      for(const effect of element.effects) {\n        effect.id = id++\n        effect.isEffect = true\n      }\n      el.material.postprocess = element\n      element.recompile()\n    }\n  }\n}\n\nconst _insertNativePostProcessToEditor = (el: any, container: any) => {\n  const muid = el.material.id;\n  // prevent to derive loop\n  if (\n    muid &&\n    !container[muid]\n  ) {\n    \n    const { material } = addShaderDebugMaterial(el.material);\n    el.material = material;\n    // to check if multiple material users\n    el.tmeDerived = true;\n    el.material.postprocess = true\n\n    container[muid] = el.material;\n    container[muid].mesh = el;\n  }\n}\n\nconst meshDebugger:any = new Mesh(undefined, new MeshBasicMaterial({\n  color: new Color(0xff0000),\n  side: FrontSide,\n  wireframe: true,\n  visible: false\n}))\nmeshDebugger.debugMaterial = true\n\nexport const traverseMaterialsToProgram = (scene: Scene, gl: any) => {\n  editorContextState.gl = gl;\n\n  if (!hasInit) {\n    hasInit = true\n    // scene.add(meshDebugger)\n  }\n  if (editorContextState.composer) {\n    editorContextState.composer.passes.forEach((pass: any) => {\n      // check if is basic three shaderpass\n      if (pass.fsQuad) {\n        _insertNativePostProcessToEditor(pass, nativePPisAlreadyDerived)\n      }\n\n      // handle postprocess and react-postprocess libs\n      if (pass.screen) {\n        _insertMaterialToEditor(pass, isAlreadyDerived, true)\n      }\n    })\n  }\n  const programs: object[] = [];\n  // update\n  scene?.traverse((el: any) => {\n    // Vanilla return Object3D so (el instanceof Mesh || el instanceof InstancedMesh) doesn't work ?\n    if (el.material) {\n      if (el.debugMaterial) {\n        return\n      }\n      _insertMaterialToEditor(el, isAlreadyDerived)\n      // inc counter if the mesh also use the material\n      if (el.material.defines && !el.tmeDerived) {\n        el.tmeDerived = true;\n        el.material.numberOfMaterialsUser++\n      }\n    }\n  });\n  let iError = 0;\n\n  gl.info.programs?.forEach((program: any) => {\n\n    const cacheKeySplited = program.cacheKey.split(',');\n    // convert and supply all mesh associated to this material to a debugger material\n    const muidDerived = cacheKeySplited[cacheKeySplited.findIndex(getMUIIndex) + 1];\n\n    if (!isNaN(muidDerived) && isAlreadyDerived[muidDerived]) {\n      isAlreadyDerived[muidDerived].program = program\n      if (isAlreadyDerived[muidDerived].postprocess) {\n        for(const effect of isAlreadyDerived[muidDerived].postprocess.effects) {\n          programs.push({\n            material: effect,\n            program: program,\n            effect: isAlreadyDerived[muidDerived].postprocess\n          });\n       };\n      } else {\n        programs.push({\n          material: isAlreadyDerived[muidDerived],\n          program: program,\n        });\n      }\n     \n      \n      if (program) {\n        const programDiagnostic: any = program;\n        if (programDiagnostic.diagnostics) {\n          // if (isAlreadyDerived[muidDerived] && isAlreadyDerived[muidDerived].mesh) {\n          //   if (!meshDebugger.material.visible) {\n          //     meshDebugger.geometry = isAlreadyDerived[muidDerived].mesh.geometry\n          //     meshDebugger.material.visible = true\n          //   }\n          //   meshDebugger.position.copy( isAlreadyDerived[muidDerived].mesh.position );\n          //   meshDebugger.quaternion.copy( isAlreadyDerived[muidDerived].mesh.quaternion );\n          //   meshDebugger.updateMatrix()\n          // }\n\n          editorState.diagnostics = programDiagnostic.diagnostics;\n        \n\n          if (editorState.diagnostics) {\n            const frag = gl.getContext().getShaderSource( programDiagnostic.fragmentShader );\n            const vert = gl.getContext().getShaderSource( programDiagnostic.fragmentShader );\n            editorState.diagnostics.frag = frag\n            editorState.diagnostics.vert = vert\n          }\n          iError++;\n        }\n      }\n   \n    } else {\n      \n      const result = nativePPisAlreadyDerived.filter((e:any) => e.fragmentShader.includes(cacheKeySplited[0]))\n      if (result.length > 0) {\n        result.forEach((pickedMaterial: any) => {\n          programs.push({\n            material: pickedMaterial,\n            program: program\n          });\n        });\n      }\n    }\n  });\n  if (iError === 0) {\n    // meshDebugger.material.visible = false\n  }\n  if (\n    programs.length !== editorContextState.programs.length\n  ) {\n    editorContextState.programs = programs;\n    editorState.triggerUpdate++;\n  }\n};\n","import React, { VFC } from 'react';\nimport { MaterialEditor } from './editor';\nimport { traverseMaterialsToProgram } from './middleware';\nimport { editorState as state, editorContextState } from './state';\n\ninterface Props {\n  className?: any;\n  position?: string | undefined;\n}\n/**\n * Core components\n */\nexport let EditorDom: VFC<Props> = () => null;\nexport let editorState: any = {};\nexport let editorContext: any = {};\nexport let materialsToProgram: any = {};\n\nif (process.env.NODE_ENV === 'production' && process.env.TME_PROD !== 'SHOW') {\n} else {\n  EditorDom = () => {\n    return <MaterialEditor />;\n  };\n  editorState = state;\n  editorContext = editorContextState;\n  materialsToProgram = traverseMaterialsToProgram;\n}\n"],"names":["styleInject","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","editorState","proxy","className","showMenu","showEditor","showUniforms","fullScreen","diffMode","obcMode","length","triggerUpdate","scene","composer","materials","diagnostics","tabs","activeMaterial","open","model","cachedModel","isModif","cache","vert","frag","devtools","editorContextState","activeMaterialRef","programs","editorWidth","editorMinusHeight","gl","commentedIncludeRegExp","includeRegExp","replaceShaderChunks","code","format","replaceAll","_substring","_indent","name","chunk","ShaderChunk","split","map","line","join","_formatToObc","resetIncludes","trim","result","filtered","filter","el","generateOBc","_code","oModel","editorContext","monacoRef","editor","getModel","getValue","mModel","base","edited","Map","index","b","e","set","onBeforeCompileFunction","forEach","value","key","valueFormated","replace","conf","comments","lineComment","blockComment","brackets","autoClosingPairs","close","notIn","surroundingPairs","folding","markers","start","RegExp","end","language","defaultToken","tokenPostfix","token","keywords","typeKeywords","operators","symbols","escapes","integersuffix","floatsuffix","encoding","tokenizer","root","next","cases","include","whitespace","comment","doccomment","string","raw","EditorTabs","snapshot","useProxy","setActive","checkIfModifications","closeTab","Object","keys","lastKey","pop","React","styles","full","entries","tactive","onClick","IoImageOutline","editorcss","colorf","IoCubeOutline","colorv","IoCloseOutline","MATERIAL_TYPES_TO_SHADERS","MeshDepthMaterial","MeshDistanceMaterial","MeshNormalMaterial","MeshBasicMaterial","MeshLambertMaterial","MeshPhongMaterial","MeshToonMaterial","MeshStandardMaterial","MeshPhysicalMaterial","MeshMatcapMaterial","LineBasicMaterial","LineDashedMaterial","PointsMaterial","ShadowMaterial","SpriteMaterial","getTypeForMaterial","material","builtinType","getNameForEditorMaterial","programGl","isEffect","toLowerCase","id","getShaderWithObc","dummyShaderLib","assign","ShaderLib","uniforms","_key","val","isNativeUniforms","obcAdded","onBeforeCompile","call","LiMenu","program","getModif","mactive","SubMenu","useState","hide","stopPropagation","visible","enabled","needsUpdate","sbopen","hmenu","RiArrowDownSFill","RiArrowRightSFill","numberOfMaterialsUser","multiusers","VscSettings","unibtn","IoEyeOffOutline","eye","IoEyeOutline","fragmentShader","vertexShader","HeadMenu","mhead","BiDockRight","AiOutlineFullscreen","BsArrowBarRight","BsArrowBarLeft","BottomAction","isShader","activeMat","cancelChange","setValue","openObcMode","setTimeout","closeObcMode","menub","menubaction","trigger","HiOutlineClipboardCopy","VscCompareChanges","closemenubaction","AiOutlineFunction","resetmenub","BiEraser","color","THREE","UniformsMenu","store","setSelection","filteredItems","size","uniform","min","max","image","copyRef","currentSrc","isColor","col","r","g","skey","Math","round","Leva","fill","flat","hideTitleBar","oneLineLabels","LevaPanel","UniformComp","loadTexture","materialUniform","preventDouble","load","x","wrapS","wrapT","isOriginal","setUniformValue","useCreateStore","useControls","elements","useEffect","get","factor","setRGB","Menu","editorHeight","menuSize","bind","useDrag","down","delta","mx","my","window","innerWidth","dom","current","setProperty","menu","menurh","touchAction","menulist","toString","FullScreen","embed","useRef","div","position","left","right","bottom","top","element","domElement","body","undefined","createPortal","embedfull","xmlns","width","height","viewBox","fillRule","transform","cx","cy","stroke","strokeWidth","embedglass","origin","modif","updateActiveShader","setModelMarkers","effect","recompile","editorOnBeforeCompile","shader","customProgramCacheKey","MaterialEditor","instanceReady","setinstanceReady","useLayoutEffect","loader","init","then","monacoInstance","defineTheme","Monokai","languages","register","setLanguageConfiguration","shaderLanguage","setMonarchTokensProvider","error","console","EditorDom","handleEditorValidation","runnable","log","errs","prefix","errorfromEffectAdjust","markets","err","getVoidEffectLine","fullProg","progArr","findIndex","includes","editorTxtArr","getVoidEditorLine","adjustUniforms","re","rl","match","message","parseInt","pos","lin","startLineNumber","startColumn","endLineNumber","endColumn","severity","MarkerSeverity","Error","HandleError","editor_c","editor_h","EditorText","EditorEdit","isEditorReady","setIsEditorReady","handleEditorDidMount","_","textContent","createModel","getText","Editor","theme","onMount","keepCurrentModel","path","defaultLanguage","defaultValue","onChange","options","formatOnType","foldingHighlight","foldingStrategy","GetDiff","diffEditor","originalModel","modifiedModel","setModel","original","modified","navi","createDiffNavigator","followsCaret","ignoreCharChanges","DiffEditor","addShaderDebugMaterial","newMaterial","epoch","Date","now","canvas","res","clientWidth","clientHeight","postprocess","time","writable","configurable","resolution","debug","getMUIIndex","muid","isAlreadyDerived","nativePPisAlreadyDerived","_insertMaterialToEditor","container","screen","defines","muidEditor","tmeDerived","mesh","effects","_insertNativePostProcessToEditor","meshDebugger","Mesh","Color","side","FrontSide","wireframe","debugMaterial","traverseMaterialsToProgram","passes","pass","fsQuad","traverse","info","cacheKeySplited","cacheKey","muidDerived","isNaN","push","programDiagnostic","getContext","getShaderSource","pickedMaterial","materialsToProgram","state"],"mappings":"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"}