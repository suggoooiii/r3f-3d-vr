{"version":3,"file":"react.esm.js","sources":["../src/html.tsx","../src/index.tsx"],"sourcesContent":["import React, {\n  forwardRef,\n  useState,\n  useRef,\n  useEffect,\n  MutableRefObject,\n  Ref,\n  HTMLAttributes,\n} from 'react';\nimport { unmountComponentAtNode, render } from 'react-dom';\nimport { Group } from 'three';\nimport { Assign } from 'utility-types';\nimport { ReactThreeFiber } from 'react-three-fiber';\n\nexport interface HtmlProps\n  extends Omit<\n    Assign<\n      HTMLAttributes<HTMLDivElement>,\n      ReactThreeFiber.Object3DNode<Group, typeof Group>\n    >,\n    'ref'\n  > {\n  portal?: MutableRefObject<HTMLElement>;\n}\n\nexport const Html = forwardRef(\n  (\n    { children, style, className, portal, ...props }: HtmlProps,\n    ref: Ref<HTMLDivElement>\n  ) => {\n    // const { gl } = useThree();\n    const [el] = useState(() => document.createElement('div'));\n    const group = useRef<Group>(null);\n    const target = portal?.current ?? document.body;\n\n    useEffect(() => {\n      if (group.current) {\n        if (target) {\n          target.appendChild(el);\n        }\n        return () => {\n          if (target) target.removeChild(el);\n          unmountComponentAtNode(el);\n        };\n      }\n      return undefined;\n    }, [target, el]);\n\n    useEffect(\n      () =>\n        void render(\n          <div ref={ref} className={className} children={children} />,\n          el\n        )\n    );\n\n    return <group {...props} ref={group} />;\n  }\n);\n","import React, { useCallback } from 'react';\nimport { useFrame, useThree } from 'react-three-fiber';\nimport {\n  EditorDom,\n  editorState,\n  editorContext,\n  materialsToProgram,\n} from '@three-material-editor/core';\nimport { Html } from './html';\n\n\nclass MaterialEditorOptions {\n  overrideRaf?: boolean;\n  className?: string;\n  fullScreen?: boolean;\n}\n\nconst optionsDefault: MaterialEditorOptions = {\n  overrideRaf: false,\n  fullScreen: true,\n};\n\n\n\nexport let Logic = () => null;\nexport let MaterialEditor = (\n  _options?: MaterialEditorOptions\n) => {};\n\nexport let useEditorComposer = () => {};\n\nif (process.env.NODE_ENV === 'production' && process.env.TME_PROD !== 'SHOW') {\n} else {\n  Logic = () => {\n    const { scene, gl } = useThree();\n\n    useFrame(() => {\n      materialsToProgram(scene, gl);\n    });\n\n    return null;\n  };\n  useEditorComposer = () => {\n    const onRefChange = useCallback(node => {\n      if (node === null) { \n        editorContext.composer = null\n      } else {\n        editorContext.composer = node\n      }\n    }, []);\n    \n    return onRefChange\n  }\n\n  MaterialEditor = (_options?: MaterialEditorOptions) => {\n    const options = Object.assign(optionsDefault, _options);\n    Object.assign(editorState, options);\n\n    return (\n      <>\n        <Logic />\n        <Html>\n          <EditorDom className={editorState.className} />\n        </Html>\n      </>\n    );\n  };\n}\n"],"names":["Html","forwardRef","ref","children","className","portal","props","useState","document","createElement","el","group","useRef","target","current","body","useEffect","appendChild","removeChild","unmountComponentAtNode","undefined","render","React","optionsDefault","overrideRaf","fullScreen","Logic","MaterialEditor","_options","useEditorComposer","process","env","NODE_ENV","TME_PROD","useThree","scene","gl","useFrame","materialsToProgram","onRefChange","useCallback","node","editorContext","composer","options","Object","assign","editorState","EditorDom"],"mappings":";;;;;;;;;;;;;;;;;;;;AAyBO,IAAMA,IAAI,gBAAGC,UAAU,CAC5B,gBAEEC,GAFF;;;MACIC,gBAAAA;MAAiBC,iBAAAA;MAAWC,cAAAA;MAAWC;;AAGzC;kBACaC,QAAQ,CAAC;AAAA,WAAMC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAN;AAAA,GAAD;MAAdC;;AACP,MAAMC,KAAK,GAAGC,MAAM,CAAQ,IAAR,CAApB;AACA,MAAMC,MAAM,sBAAGR,MAAH,oBAAGA,MAAM,CAAES,OAAX,8BAAsBN,QAAQ,CAACO,IAA3C;AAEAC,EAAAA,SAAS,CAAC;AACR,QAAIL,KAAK,CAACG,OAAV,EAAmB;AACjB,UAAID,MAAJ,EAAY;AACVA,QAAAA,MAAM,CAACI,WAAP,CAAmBP,EAAnB;AACD;;AACD,aAAO;AACL,YAAIG,MAAJ,EAAYA,MAAM,CAACK,WAAP,CAAmBR,EAAnB;AACZS,QAAAA,sBAAsB,CAACT,EAAD,CAAtB;AACD,OAHD;AAID;;AACD,WAAOU,SAAP;AACD,GAXQ,EAWN,CAACP,MAAD,EAASH,EAAT,CAXM,CAAT;AAaAM,EAAAA,SAAS,CACP;AAAA,WACE,KAAKK,MAAM,eACTC,mBAAA,MAAA;AAAKpB,MAAAA,GAAG,EAAEA;AAAKE,MAAAA,SAAS,EAAEA;AAAWD,MAAAA,QAAQ,EAAEA;KAA/C,CADS,EAETO,EAFS,CADb;AAAA,GADO,CAAT;AAQA,sBAAOY,mBAAA,QAAA,oBAAWhB;AAAOJ,IAAAA,GAAG,EAAES;IAAvB,CAAP;AACD,CAhC2B,CAAvB;;ACRP,IAAMY,cAAc,GAA0B;AAC5CC,EAAAA,WAAW,EAAE,KAD+B;AAE5CC,EAAAA,UAAU,EAAE;AAFgC,CAA9C;AAOA,IAAWC,KAAK,GAAG;AAAA,SAAM,IAAN;AAAA,CAAZ;AACP,IAAWC,cAAc,GAAG,wBAC1BC,QAD0B,IAArB;AAIP,IAAWC,iBAAiB,GAAG,+BAAxB;;AAEP,IAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,IAAyCF,OAAO,CAACC,GAAR,CAAYE,QAAZ,KAAyB,MAAtE,EAA8E,CAA9E,MACO;AACLP,EAAAA,KAAK,GAAG;oBACgBQ,QAAQ;QAAtBC,kBAAAA;QAAOC,eAAAA;;AAEfC,IAAAA,QAAQ,CAAC;AACPC,MAAAA,kBAAkB,CAACH,KAAD,EAAQC,EAAR,CAAlB;AACD,KAFO,CAAR;AAIA,WAAO,IAAP;AACD,GARD;;AASAP,EAAAA,iBAAiB,GAAG;AAClB,QAAMU,WAAW,GAAGC,WAAW,CAAC,UAAAC,IAAI;AAClC,UAAIA,IAAI,KAAK,IAAb,EAAmB;AACjBC,QAAAA,aAAa,CAACC,QAAd,GAAyB,IAAzB;AACD,OAFD,MAEO;AACLD,QAAAA,aAAa,CAACC,QAAd,GAAyBF,IAAzB;AACD;AACF,KAN8B,EAM5B,EAN4B,CAA/B;AAQA,WAAOF,WAAP;AACD,GAVD;;AAYAZ,EAAAA,cAAc,GAAG,wBAACC,QAAD;AACf,QAAMgB,OAAO,GAAGC,MAAM,CAACC,MAAP,CAAcvB,cAAd,EAA8BK,QAA9B,CAAhB;AACAiB,IAAAA,MAAM,CAACC,MAAP,CAAcC,WAAd,EAA2BH,OAA3B;AAEA,wBACEtB,mBAAA,eAAA,MAAA,eACEA,mBAAA,CAACI,KAAD,MAAA,CADF,eAEEJ,mBAAA,CAACtB,IAAD,MAAA,eACEsB,mBAAA,CAAC0B,SAAD;AAAW5C,MAAAA,SAAS,EAAE2C,WAAW,CAAC3C;KAAlC,CADF,CAFF,CADF;AAQD,GAZD;AAaD;;;;"}