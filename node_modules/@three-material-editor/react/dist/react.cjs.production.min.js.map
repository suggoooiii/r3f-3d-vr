{"version":3,"file":"react.cjs.production.min.js","sources":["../src/html.tsx","../src/index.tsx"],"sourcesContent":["import React, {\n  forwardRef,\n  useState,\n  useRef,\n  useEffect,\n  MutableRefObject,\n  Ref,\n  HTMLAttributes,\n} from 'react';\nimport { unmountComponentAtNode, render } from 'react-dom';\nimport { Group } from 'three';\nimport { Assign } from 'utility-types';\nimport { ReactThreeFiber } from 'react-three-fiber';\n\nexport interface HtmlProps\n  extends Omit<\n    Assign<\n      HTMLAttributes<HTMLDivElement>,\n      ReactThreeFiber.Object3DNode<Group, typeof Group>\n    >,\n    'ref'\n  > {\n  portal?: MutableRefObject<HTMLElement>;\n}\n\nexport const Html = forwardRef(\n  (\n    { children, style, className, portal, ...props }: HtmlProps,\n    ref: Ref<HTMLDivElement>\n  ) => {\n    // const { gl } = useThree();\n    const [el] = useState(() => document.createElement('div'));\n    const group = useRef<Group>(null);\n    const target = portal?.current ?? document.body;\n\n    useEffect(() => {\n      if (group.current) {\n        if (target) {\n          target.appendChild(el);\n        }\n        return () => {\n          if (target) target.removeChild(el);\n          unmountComponentAtNode(el);\n        };\n      }\n      return undefined;\n    }, [target, el]);\n\n    useEffect(\n      () =>\n        void render(\n          <div ref={ref} className={className} children={children} />,\n          el\n        )\n    );\n\n    return <group {...props} ref={group} />;\n  }\n);\n","import React, { useCallback } from 'react';\nimport { useFrame, useThree } from 'react-three-fiber';\nimport {\n  EditorDom,\n  editorState,\n  editorContext,\n  materialsToProgram,\n} from '@three-material-editor/core';\nimport { Html } from './html';\n\n\nclass MaterialEditorOptions {\n  overrideRaf?: boolean;\n  className?: string;\n  fullScreen?: boolean;\n}\n\nconst optionsDefault: MaterialEditorOptions = {\n  overrideRaf: false,\n  fullScreen: true,\n};\n\n\n\nexport let Logic = () => null;\nexport let MaterialEditor = (\n  _options?: MaterialEditorOptions\n) => {};\n\nexport let useEditorComposer = () => {};\n\nif (process.env.NODE_ENV === 'production' && process.env.TME_PROD !== 'SHOW') {\n} else {\n  Logic = () => {\n    const { scene, gl } = useThree();\n\n    useFrame(() => {\n      materialsToProgram(scene, gl);\n    });\n\n    return null;\n  };\n  useEditorComposer = () => {\n    const onRefChange = useCallback(node => {\n      if (node === null) { \n        editorContext.composer = null\n      } else {\n        editorContext.composer = node\n      }\n    }, []);\n    \n    return onRefChange\n  }\n\n  MaterialEditor = (_options?: MaterialEditorOptions) => {\n    const options = Object.assign(optionsDefault, _options);\n    Object.assign(editorState, options);\n\n    return (\n      <>\n        <Logic />\n        <Html>\n          <EditorDom className={editorState.className} />\n        </Html>\n      </>\n    );\n  };\n}\n"],"names":["Html","forwardRef","ref","children","className","portal","props","el","useState","document","createElement","group","useRef","target","current","body","useEffect","appendChild","removeChild","unmountComponentAtNode","render","React","optionsDefault","overrideRaf","fullScreen","Logic","exports","_options","useEditorComposer","process","env","TME_PROD","useThree","scene","gl","useFrame","materialsToProgram","useCallback","node","editorContext","composer","MaterialEditor","options","Object","assign","editorState","EditorDom"],"mappings":"mPAyBaA,EAAOC,cAClB,WAEEC,SADEC,IAAAA,SAAiBC,IAAAA,UAAWC,IAAAA,OAAWC,kLAIlCC,EAAMC,YAAS,kBAAMC,SAASC,cAAc,aAC7CC,EAAQC,SAAc,MACtBC,iBAASR,SAAAA,EAAQS,WAAWL,SAASM,YAE3CC,aAAU,cACJL,EAAMG,eACJD,GACFA,EAAOI,YAAYV,GAEd,WACDM,GAAQA,EAAOK,YAAYX,GAC/BY,yBAAuBZ,MAI1B,CAACM,EAAQN,IAEZS,aACE,WACOI,SACHC,uBAAKnB,IAAKA,EAAKE,UAAWA,EAAWD,SAAUA,IAC/CI,MAICc,yCAAWf,GAAOJ,IAAKS,QCvC5BW,EAAwC,CAC5CC,aAAa,EACbC,YAAY,GAKHC,cAAQ,kBAAM,MACzBC,uBAA4B,SAC1BC,KAGSC,0BAAoB,aAEuC,SAAzBC,QAAQC,IAAIC,WAEvDN,cAAQ,iBACgBO,aAAdC,IAAAA,MAAOC,IAAAA,UAEfC,YAAS,WACPC,qBAAmBH,EAAOC,MAGrB,MAETN,0BAAoB,kBACES,eAAY,SAAAC,GAE5BC,gBAAcC,SADH,OAATF,EACuB,KAEAA,IAE1B,KAKLG,uBAAiB,SAACd,OACVe,EAAUC,OAAOC,OAAOtB,EAAgBK,UAC9CgB,OAAOC,OAAOC,cAAaH,GAGzBrB,gCACEA,gBAACI,oBACDJ,gBAACrB,OACCqB,gBAACyB,aAAU1C,UAAWyC,cAAYzC"}