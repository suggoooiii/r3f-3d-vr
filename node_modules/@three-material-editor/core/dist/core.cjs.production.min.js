"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=e(t),r=require("valtio"),o=require("valtio/utils"),i=require("three"),a=require("@monaco-editor/react"),l=e(a),d=require("react-icons/io5"),s=require("react-use-gesture"),c=require("react-icons/ri"),u=require("react-icons/vsc"),m=require("react-icons/ai"),f=require("react-icons/bi"),p=require("react-icons/bs"),g=require("react-icons/hi"),v=require("leva"),_=require("react-dom");function h(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}h("\n.editor-module_colorf__2lhnn {\n  color: rgb(120, 220, 232);\n}\n.editor-module_colorv__31zS_ {\n  color: rgb(252, 152, 103);\n}\n\n.editor-module_editor_c__16HRX {\n  --editor-menu-width: 240px;\n  --editor-width: 520px;\n  --editor-minus-height: 0px;\n\n  position: fixed;\n  top: 0;\n  right: 0;\n  z-index: 999;\n\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n  'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n  sans-serif;\n  color: #fff;\n  margin: 0;\n  padding: 4px 6px;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n\n.editor-module_editor__1MUvb {\n  position: fixed;\n  top: 0;\n  right: 0;\n  z-index: 999;\n  background-color: rgba(36,36,36,1);\n  height: min(100vh, max(120px, calc(100% - var(--editor-minus-height))));\n  padding-top: 28px;\n  width: min(calc(100vw - 160px), var(--editor-width)) !important;\n  transition: width .3s cubic-bezier(0.075, 0.82, 0.165, 1), height .3s cubic-bezier(0.075, 0.82, 0.165, 1);\n}\n.editor-module_editor__1MUvb svg {\n  display: inline-block;\n  vertical-align: initial;\n}\n.editor-module_editor__1MUvb *, .editor-module_editor__1MUvb *::after, .editor-module_editor__1MUvb *::before {\n  box-sizing: border-box;\n}\n.editor-module_editor_c__16HRX.editor-module_full__2cjlZ {\n  width: calc(100% - var(--editor-menu-width));\n  height: 100%;\n}\n.editor-module_editor_c__16HRX.editor-module_full__2cjlZ .editor-module_editor__1MUvb {\n  width: calc(100% - var(--editor-menu-width)) !important;\n  height: 100%;\n}\n\n.editor-module_editor_h__MRECc {\n  --editor-width: 0px !important;\n}\n.editor-module_editor__1MUvb * {\n  font-family: inherit;\n}\n.editor-module_editor__1MUvb.editor-module_top-left__1Lf1m {\n  right: initial;\n  left: 0;\n}\n\n.editor-module_editor__1MUvb.editor-module_bottom-left__1W_R- {\n  right: initial;\n  top: initial;\n  bottom: 0;\n  left: 0;\n}\n.editor-module_editor__1MUvb.editor-module_bottom-right__2VkdP {\n  top: initial;\n  bottom: 0;\n}\n.editor-module_embed__2iwnO {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n}\n.editor-module_embed__2iwnO > svg {\n  display: none;\n  position: absolute;\n  top: 8px;\n  left: 10px;\n}\n.editor-module_embedfull__9UVqb {\n  position: fixed;\n  z-index: 1000;\n  top: initial;\n  left: initial;\n  /* pointer-events: none; */\n  right: 14px;\n  bottom: 14px;\n  box-shadow: 0px 8px 28px rgb(0 0 0 / 25%), 0 10px 10px rgb(0 0 0 / 22%);\n\n  width: 70% !important;\n  height: auto !important;\n  max-width: 800px !important;\n  max-height: 620px !important;\n}\n.editor-module_embedfull__9UVqb canvas {\n  width: 100% !important;\n  height: 100% !important;\n}\n.editor-module_embedfull__9UVqb > svg {\n  display: block;\n}\n.editor-module_embedglass__2BjeI {\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  top: 0;\n  -webkit-backdrop-filter: blur(10px);\n          backdrop-filter: blur(10px);\n  z-index: -1;\n}");var x=r.proxy({className:"",showMenu:!1,showEditor:!1,showUniforms:!1,fullScreen:!0,diffMode:!1,obcMode:!1,length:0,triggerUpdate:0,scene:null,composer:null,materials:[],diagnostics:{},tabs:{},activeMaterial:{type:"",open:!1,model:null,cachedModel:null,isModif:!1,cache:{vert:"",frag:""}}});o.devtools(x,"material editor");var b={materials:{},activeMaterialRef:{},programs:[],editorWidth:520,editorMinusHeight:0,gl:null},M=/^(\s*)\/\/ #include <([a-zA-Z0-9_]+)>/gm,y=/^(\s*)#include <([a-zA-Z0-9_]+)>/gm,w=function(e){if("string"==typeof e)return e.replaceAll(y,(function(e,t,n){var r=i.ShaderChunk[n];return"// #include <"+n+">\n\t"+(r=r.split("\n").map((function(e){return e})).join("\n\t"))+"\n//\n"}))},E=function(e){if("string"==typeof e)return e.replaceAll(M,(function(e,t,n){return"#include <"+n+">"})).trim().split(y).filter((function(e){return""!==e}))},C={comments:{lineComment:"//",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"[",close:"]"},{open:"{",close:"}"},{open:"(",close:")"},{open:"'",close:"'",notIn:["string","comment"]},{open:'"',close:'"',notIn:["string"]}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],folding:{markers:{start:new RegExp("^\\s*#pragma\\s+region\\b"),end:new RegExp("^\\s*#pragma\\s+endregion\\b")}}},k={defaultToken:"",tokenPostfix:".cpp",brackets:[{token:"delimiter.curly",open:"{",close:"}"},{token:"delimiter.parenthesis",open:"(",close:")"},{token:"delimiter.square",open:"[",close:"]"},{token:"delimiter.angle",open:"<",close:">"}],keywords:["discard","length","smoothstep","uniform","precision","mediump","highp","vec2","vec3","vec4","ivec2","ivec3","ivec4","abstract","amp","array","auto","bool","break","case","catch","char","class","const","gl_FragColor","constexpr","const_cast","continue","cpu","decltype","default","delegate","delete","do","double","dynamic_cast","each","else","enum","event","explicit","export","extern","false","final","finally","float","for","friend","gcnew","generic","goto","if","in","initonly","inline","int","interface","interior_ptr","internal","literal","long","mutable","namespace","new","noexcept","nullptr","__nullptr","operator","override","partial","pascal","pin_ptr","private","property","protected","public","ref","register","reinterpret_cast","restrict","return","safe_cast","sealed","short","signed","sizeof","static","static_assert","static_cast","struct","switch","template","this","thread_local","throw","tile_static","true","try","typedef","typeid","typename","union","unsigned","using","virtual","void","volatile","wchar_t","where","while"],typeKeywords:"float int bool void\nvec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4\nmat2 mat3 mat4\nsampler2D sampler3D samplerCube\nconst attribute uniform varying".split(/\s+/),operators:["=",">","<","!","~","?",":","==","<=",">=","!=","&&","||","++","--","+","-","*","/","&","|","^","%","<<",">>",">>>","+=","-=","*=","/=","&=","|=","^=","%=","<<=",">>=",">>>="],symbols:/[=><!~?:&|+\-*/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,integersuffix:/(ll|LL|u|U|l|L)?(ll|LL|u|U|l|L)?/,floatsuffix:/[fFlL]?/,encoding:/u|u8|U|L/,tokenizer:{root:[[/@encoding?R"(?:([^ ()\\\t]*))\(/,{token:"string.raw.begin",next:"@raw.$1"}],[/[a-z_$][\w$]*/,{cases:{"@typeKeywords":"keyword","@keywords":"keyword","@default":"identifier"}}],[/[A-Z][\w$]*/,"type.identifier"],{include:"@whitespace"},[/\[\[.*\]\]/,"annotation"],[/^\s*#include/,{token:"keyword.directive.include",next:"@include"}],[/^\s*#\s*\w+/,"keyword"],[/[{}()[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/\d*\d+[eE]([-+]?\d+)?(@floatsuffix)/,"number.float"],[/\d*\.\d+([eE][-+]?\d+)?(@floatsuffix)/,"number.float"],[/0[xX][0-9a-fA-F']*[0-9a-fA-F](@integersuffix)/,"number.hex"],[/0[0-7']*[0-7](@integersuffix)/,"number.octal"],[/0[bB][0-1']*[0-1](@integersuffix)/,"number.binary"],[/\d[\d']*\d(@integersuffix)/,"number"],[/\d(@integersuffix)/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string"],[/'[^\\']'/,"string"],[/(')(@escapes)(')/,["string","string.escape","string"]],[/'/,"string.invalid"]],whitespace:[[/[ \t\r\n]+/,""],[/\/\*\*(?!\/)/,"comment.doc","@doccomment"],[/\/\*/,"comment","@comment"],[/\/\/.*$/,"comment"]],comment:[[/[^/*]+/,"comment"],[/\*\//,"comment","@pop"],[/[/*]/,"comment"]],doccomment:[[/[^/*]+/,"comment.doc"],[/\*\//,"comment.doc","@pop"],[/[/*]/,"comment.doc"]],string:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],raw:[[/(.*)(\))(?:([^ ()\\\t]*))(")/,{cases:{"$3==$S2":["string.raw","string.raw.end","string.raw.end",{token:"string.raw.end",next:"@pop"}],"@default":["string.raw","string.raw","string.raw","string.raw"]}}],[/.*/,"string.raw"]],include:[[/(\s*)(<)([^<>]*)(>)/,["","keyword.directive.include.begin","string.include.identifier",{token:"keyword.directive.include.end",next:"@pop"}]],[/(\s*)(")([^"]*)(")/,["","keyword.directive.include.begin","string.include.identifier",{token:"keyword.directive.include.end",next:"@pop"}]]]}};h(".tabs-module_tabs__200e9 {\n  position: fixed;\n  top: 0;\n  right: 0;\n  z-index: 1000;\n  background: rgb(68 68 68);\n  color: #ccc;\n  padding: 0;\n  text-align: center;\n  font-size: 13px;\n  display: flex;\n  width: var(--editor-width);\n  overflow-x: auto;\n}\n.tabs-module_tabs__200e9.tabs-module_full__2aFRA {\n  width: calc(100% - var(--editor-menu-width));\n}\n.tabs-module_tabs__200e9 > div {\n  cursor: pointer;\n  display: flex;\n}\n.tabs-module_tabs__200e9 > div > div{\n  padding: 7px 7px;\n  display: inline-flex;\n  line-height: 10px;\n  border-right: 1px solid #37383a;\n}\n.tabs-module_tabs__200e9 svg {\n  font-size: 14px;\n  margin: 0 4px;\n}\n.tabs-module_tactive__1bB_x {\n  background: rgb(31,31,31);\n  color: #fff;\n}");var S=function(){var e=r.useProxy(x);return n.createElement("div",{className:"tabs-module_tabs__200e9 "+(e.showEditor&&e.fullScreen?"tabs-module_full__2aFRA":"")},Object.entries(e.tabs).map((function(t){var r=t[0],o=t[1],i=o.model.replace("urn:","");return n.createElement("div",{key:r},n.createElement("div",{className:r===e.activeMaterial.model?"tabs-module_tactive__1bB_x":"",onClick:function(){!function(e){x.obcMode||x.diffMode?(x.activeMaterial.model=x.activeMaterial.cachedModel,x.activeMaterial.cachedModel=null,x.diffMode=!1,x.obcMode=!1,x.triggerUpdate++):x.activeMaterial=e,q()}(o)}},"frag"===o.type?n.createElement(d.IoImageOutline,{className:"editor-module_colorf__2lhnn"}):n.createElement(d.IoCubeOutline,{className:"editor-module_colorv__31zS_"})," ",""+i," ",n.createElement(d.IoCloseOutline,{onClick:function(){return function(e){if(delete x.tabs[e],0===Object.keys(x.tabs).length)return x.obcMode=!1,x.diffMode=!1,void x.triggerUpdate++;var t=Object.keys(x.tabs).pop();t&&(x.activeMaterial=x.tabs[t])}(o.model)}})))})))},R="menu-module_menubaction__3JPZB";h(".menu-module_menu__3tJFo {\n  --sizes-controlWidth: initial;\n  --colors-elevation1: #292b2d;\n  --colors-elevation2: #292b2d;\n  --colors-leva__elevation2: #292b2d;\n  position: fixed;\n  z-index: 999;\n  transform: translateX(calc(min(calc(100vw - 160px), var(--editor-width)) * -1 - 100% + 7px));\n  top: 0;\n  background-color: rgb(41, 43, 45);\n  color: rgba(145,145,145,1);\n  font-size: 13px;\n  padding: 5px 0;\n  min-width: 240px;\n  cursor: nesw-resize;\n  height: min(100vh, max(120px, calc(100% - var(--editor-minus-height))));\n  overflow: hidden;\n  padding-bottom: 23px;\n  transition: transform .3s cubic-bezier(0.075, 0.82, 0.165, 1), width .3s cubic-bezier(0.075, 0.82, 0.165, 1), height .3s cubic-bezier(0.075, 0.82, 0.165, 1);\n}\n.menu-module_menu__3tJFo svg {\n  display: inline-block;\n  vertical-align: initial;\n}\n.menu-module_menu__3tJFo.menu-module_full__2T-xJ {\n  left: 0;\n  height: 100%;\n  width: var(--editor-menu-width);\n  transform: none;\n}\n.menu-module_menurh__ryZrO {\n  height: auto;\n}\n\n.menu-module_menu__3tJFo svg {\n  margin-bottom: -3px;\n  cursor: pointer;\n}\n.menu-module_menu__3tJFo svg.menu-module_unibtn__3xwXz {\n  position: absolute;\n  right: 23px;\n  margin: 3px 7px;\n}\n\n.menu-module_menu__3tJFo svg.menu-module_eye__3r6NQ {\n  position: absolute;\n  right: 0;\n  margin: 3px 7px;\n}\n\n.menu-module_mhead__1pA2z {\n  display: flex;\n  justify-content: space-around;\n  padding: 0px 4px 4px 4px;\n}\n.menu-module_mhead__1pA2z svg {\n  width: 24px;\n  height: 24px;\n  padding: 3px;\n}\n.menu-module_hmenu__Rse6B  {\n  padding: 3px;\n  cursor: pointer;\n  position: relative;\n}\n.menu-module_menu__3tJFo ul {\n  margin: 2px 0px;\n  padding: 0px 0px 3px 0;\n}\n.menu-module_menu__3tJFo > div {\n  padding: 4px 0;\n  cursor: pointer;\n}\n.menu-module_menu__3tJFo .menu-module_sbopen__FVP6G {\n  color: #ccc;\n}\n.menu-module_menu__3tJFo li {\n  list-style: none;\n  padding: 4px 6px 4px 20px;\n  cursor: pointer;\n}\n.menu-module_open__1r8nP {\n  color: rgb(195 175 144);\n}\n.menu-module_mactive__ka-lp {\n  background-color: rgb(55,55,61);\n  color: rgb(255 193 100);\n}\n.menu-module_multiusers__3wEda {\n  padding-left: 16px;\n}\n.menu-module_multiusers__3wEda small {\n  margin-top: -4px;\n  display: inline-block;\n  position: absolute;\n  font-size: 9px;\n}\n\n.menu-module_menulist__2cpKO {\n  max-height: 100%;\n  overflow: scroll;\n  padding-bottom: 30px;\n}\n.menu-module_menub__eMuJa {\n  display: flex;\n  justify-content: space-around;\n  flex-direction: column;\n  padding: 4px;\n}\n\n.menu-module_menubaction__3JPZB {\n  background-color: rgb(0,122,204);\n  display: block;\n  font-weight: bold;\n  line-height: 30px;\n  padding: 0 6px;\n  color: #fff;\n  cursor: pointer;\n  margin: 7px;\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  text-align: center;\n}\n.menu-module_menubaction__3JPZB.menu-module_closemenubaction__1lf-n {\n  background-color: rgb(235, 38, 94);\n}\n\n.menu-module_resetmenub__2_Z5g {\n  margin-top: 40px;\n}\n.menu-module_isModif__TUfP2 {\n  font-weight: bold;\n  float: revert;\n  float: right;\n  padding: 0 2px;\n}");var U={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},O=function(e,t){return(e.isEffect?e.name.replace("Effect","").toLowerCase():function(e){return U[e]||("ShaderMaterial"===e?"shader":"unknown")}(t.name))+"_"+t.id},F=function(e){var t=e.type,o=e.program,i=r.useProxy(x),a=O(o.material,o.program);return n.createElement("li",{className:(i.tabs["urn:"+a+"."+t]?"menu-module_open__1r8nP":"")+" + ' ' + "+(i.activeMaterial&&i.activeMaterial.model==="urn:"+a+"."+t?"menu-module_mactive__ka-lp":""),onClick:function(){var e={type:t,open:!0,cachedModel:"urn:"+a+"."+t,isModif:!1,model:"urn:"+a+"."+t};x.activeMaterial=e,exports.editorContext.activeMaterialRef[e.model]=o,x.tabs["urn:"+a+"."+t]=e,x.showUniforms=!0,x.showEditor=!0,x.diffMode=!1,x.obcMode=!1,x.triggerUpdate++,q()}},"frag"===t?n.createElement(d.IoImageOutline,{className:"editor-module_colorf__2lhnn"}):n.createElement(d.IoCubeOutline,{className:"editor-module_colorv__31zS_"})," ",a,".",t," ",function(e){if(exports.editorContext.monacoRef){var t=exports.editorContext.monacoRef.editor.getModel("urn:"+a+"."+e+"_orig"),n=exports.editorContext.monacoRef.editor.getModel("urn:"+a+"."+e);return t&&n?t.getValue()!==n.getValue():null}}(t)&&n.createElement("span",{className:"menu-module_isModif__TUfP2"},"M"))},N=function(e){var o=e.program,i=r.useProxy(x),a=t.useState(!0),l=a[0],s=a[1],m=o.material,f=o.program;if(!f)return null;var p=O(m,f);return f&&m?n.createElement("div",{key:i.triggerUpdate,className:l?"menu-module_sbopen__FVP6G":""},n.createElement("div",{className:"menu-module_hmenu__Rse6B "+(i.tabs["urn:"+p+".frag"]||i.tabs["urn:"+p+".vert"]?"menu-module_open__1r8nP":""),onClick:function(e){e.stopPropagation();var t={type:"",open:!0,isModif:!1,model:"urn:"+p};x.activeMaterial=t,exports.editorContext.activeMaterialRef[t.model]=o,x.showEditor=!1,x.diffMode=!1,x.obcMode=!1,x.showUniforms=!0,x.triggerUpdate++}},n.createElement(l?c.RiArrowDownSFill:c.RiArrowRightSFill,{onClick:function(){s(!l)}})," ",p,m&&m.numberOfMaterialsUser>1&&n.createElement("span",{className:"menu-module_multiusers__3wEda"},n.createElement(d.IoCubeOutline,null),n.createElement("small",null,m.numberOfMaterialsUser)),n.createElement(u.VscSettings,{className:"menu-module_unibtn__3xwXz"}),n.createElement(!m||m.visible||m.isEffect?d.IoEyeOutline:d.IoEyeOffOutline,{onClick:function(e){e.stopPropagation(),m.visible=!m.visible,m.enabled=!m.enabled,m.needsUpdate=!0,x.triggerUpdate++},className:"menu-module_eye__3r6NQ"})),l&&n.createElement("ul",null,m.fragmentShader&&n.createElement(F,{program:o,type:"frag"}),m.vertexShader&&n.createElement(F,{program:o,type:"vert"}))):null},B=function(){var e=r.useProxy(x);return n.createElement("div",{key:e.triggerUpdate,className:"menu-module_mhead__1pA2z"},x.showEditor&&x.fullScreen&&n.createElement(f.BiDockRight,{onClick:function(){x.fullScreen=!1}}),x.showEditor&&!x.fullScreen&&n.createElement(m.AiOutlineFullscreen,{onClick:function(){x.fullScreen=!0}}),n.createElement("div",{onClick:function(){x.showEditor=!x.showEditor,x.diffMode=!1}},n.createElement(e.showEditor?p.BsArrowBarRight:p.BsArrowBarLeft,null)))},P=function(){var e=r.useProxy(x),t=!1;if(!b.monacoRef||!x.activeMaterial.model)return null;var o=b.activeMaterialRef[x.activeMaterial.model];if(o&&o.material&&(t="ShaderMaterial"===o.material.type),x.obcMode&&x.activeMaterial.cachedModel&&(o=b.activeMaterialRef[x.activeMaterial.cachedModel]),!o)return null;var i=o.material;return e.activeMaterial&&e.activeMaterial.isModif&&e.showEditor&&i?n.createElement("div",{key:e.triggerUpdate,className:"menu-module_menub__eMuJa"},e.obcMode&&n.createElement("div",{className:""+R,onClick:function(){b.editor.trigger("source","editor.action.clipboardCopyAction")}},n.createElement(g.HiOutlineClipboardCopy,null)," Copy"),!e.diffMode&&!e.obcMode&&n.createElement("div",{className:R,onClick:function(){x.diffMode=!0}},n.createElement(u.VscCompareChanges,null)," Analyze diff"),e.diffMode&&!e.obcMode&&n.createElement("div",{className:R+" menu-module_closemenubaction__1lf-n",onClick:function(){x.diffMode=!1}},n.createElement(u.VscCompareChanges,null)," Close diff"),!t&&!e.diffMode&&!e.obcMode&&i&&!i.isEffect&&n.createElement("div",{className:R,onClick:function(){x.activeMaterial.cachedModel=x.activeMaterial.model+"",setTimeout((function(){x.activeMaterial.model="urn:obc_result",x.showEditor=!0,x.diffMode=!1,x.obcMode=!0}),0)}},n.createElement(m.AiOutlineFunction,null)," onBeforeCompile"),!t&&e.obcMode&&i&&!i.isEffect&&n.createElement("div",{className:R+" menu-module_closemenubaction__1lf-n",onClick:function(){x.activeMaterial.model=x.activeMaterial.cachedModel,x.activeMaterial.cachedModel=null,x.diffMode=!1,x.obcMode=!1,x.triggerUpdate++}},n.createElement(m.AiOutlineFunction,null)," onBeforeCompile"),!e.obcMode&&!e.diffMode&&n.createElement("div",{className:R+" menu-module_closemenubaction__1lf-n menu-module_resetmenub__2_Z5g",onClick:function(){var e=x.activeMaterial.type,t=O(i,o.program),n=b.monacoRef.editor.getModel("urn:"+t+"."+e+"_orig"),r=b.monacoRef.editor.getModel("urn:"+t+"."+e);r&&r.setValue(n.getValue()),x.activeMaterial.isModif=!1}},n.createElement(f.BiEraser,null)," Reset shader")):null},A=new i.Color,z=function(){var e=r.useProxy(x),t=n.useState(null),o=t[0],i=t[1];if(!b.monacoRef)return null;if(!b.activeMaterialRef||!x.activeMaterial.model)return null;var a=b.activeMaterialRef[x.activeMaterial.model];if(!a)return null;var l=a.material;if(!x.showUniforms||!l.uniforms)return null;var d={};if(l.uniforms.size&&l.uniforms.size>0)l.uniforms.forEach((function(e,t){if(!e.isNativeUniforms&&"time"!==t){if("number"==typeof e.value&&(e.min=-1,e.max=1),e.type&&delete e.type,e&&e.value&&e.value.image)d[t]={image:e.value},e.copyRef=e.value.image.currentSrc;else if(e.value&&e.value.isColor){var n=e.value;d[t]={r:255*n.r,g:255*n.g,b:255*n.b}}else d[t]=e;l.uniforms.set(t,e),Object.entries(d[t]).map((function(e){"string"==typeof e[1]&&delete d[t][e[0]]}))}}));else if("object"==typeof l.uniforms){if(0===Object.keys(l.uniforms).length)return null;Object.entries(l.uniforms).map((function(e){var t=e[0],n=e[1];if(!n.isNativeUniforms&&"time"!==t){if("number"==typeof n.value&&(n.min=Math.min(-1,-Math.round(n.value)),n.max=Math.max(1,Math.round(n.value))),n.type&&delete n.type,n&&n.value&&n.value.image)d[t]={image:n.value},n.copyRef=n.value.image.currentSrc;else if(n.value&&n.value.isColor){var r=n.value;d[t]={r:255*r.r,g:255*r.g,b:255*r.b}}else d[t]=n;Object.entries(d[t]).map((function(e){"string"==typeof e[1]&&delete d[t][e[0]]}))}}))}return n.createElement("div",null,n.createElement(v.Leva,{fill:!0,flat:!0,hideTitleBar:!0,oneLineLabels:!1}),n.createElement(v.LevaPanel,{fill:!0,flat:!0,hideTitleBar:!0,store:o,oneLineLabels:!1}),n.createElement("div",{key:e.triggerUpdate},n.createElement(L,{filteredItems:d,setSelection:i,uniforms:l.uniforms,store:o})))},j=function(e,t,n,r){t&&t.value&&t.value.image&&(r&&r!==t.value.image.preventDouble?(new i.TextureLoader).load(r,(function(o){t.value=o,t.value.wrapS=t.value.wrapT=i.RepeatWrapping,t.value.image.preventDouble=r,t.value.image.isOriginal=!1,t.value.needsUpdate=!0,I(e,t,n)})):r||t.value.image.isOriginal||(new i.TextureLoader).load(t.copyRef,(function(o){t.value=o,t.value.wrapS=t.value.wrapT=i.RepeatWrapping,t.value.image.preventDouble=r,t.value.image.isOriginal=!0,t.value.needsUpdate=!0,I(e,t,n)})))},L=function(e){var n=e.filteredItems,r=e.uniforms,o=e.setSelection,i=v.useCreateStore(),a=v.useControls((function(){return n}),{store:i})[0];return t.useEffect((function(){for(var e=0,t=Object.entries(a);e<t.length;e++){var n=t[e],o=n[0],i=n[1],l=i,d=r[o]||r.get(o);"string"!=typeof i&&i?d&&(l.r&&l.g&&l.b?(d.value=A.setRGB(l.r/255,l.g/255,l.b/255),I(r,d,o)):(d.value=i,I(r,d,o))):j(r,d,o,i)}}),[a]),t.useEffect((function(){o(i)}),[i,o]),null},I=function(e,t,n){e[n]||e.set(n,t)},D=function(){var e=r.useProxy(x),t=exports.editorContext.editorWidth,o=exports.editorContext.editorMinusHeight,i=s.useDrag((function(e){var n=e.delta,r=n[0],i=n[1];x.fullScreen||(e.down&&"undefined"!=typeof window?(t-=t-r>window.innerWidth-160?0:r,o-=o-i<0?0:i,exports.editorContext.dom.current.style.setProperty("--editor-width",t+"px"),exports.editorContext.dom.current.style.setProperty("--editor-minus-height",o+"px")):("undefined"!=typeof window&&(window.innerWidth-t<200&&(t=window.innerWidth-160),o<40&&(o=0),exports.editorContext.dom.current.style.setProperty("--editor-width",t+"px"),exports.editorContext.dom.current.style.setProperty("--editor-minus-height",o+"px")),exports.editorContext.editorWidth=t,exports.editorContext.editorMinusHeight=o))}));return exports.editorContext.programs.length>0?n.createElement("div",Object.assign({className:"menu-module_menu__3tJFo "+(e.showEditor?"":"menu-module_menurh__ryZrO")+" "+(e.showEditor&&e.fullScreen?"menu-module_full__2T-xJ":"")},i(),{style:{touchAction:"none"}}),n.createElement(B,null),n.createElement("div",{key:e.triggerUpdate,className:"menu-module_menulist__2cpKO"},exports.editorContext.programs.map((function(e,t){return n.createElement(N,{program:e,key:t.toString()})}))),n.createElement(z,null),n.createElement(P,null)):null},V=function(){var e=r.useProxy(x),o=t.useRef(null),i=document.createElement("div");i.style.position="absolute",i.style.left="0",i.style.right="0",i.style.bottom="0",i.style.top="0";var a=t.useState((function(){return i}))[0],l=b.gl.domElement;return t.useEffect((function(){if(a&&o.current)return document.body.appendChild(a),a.appendChild(l),o.current.appendChild(b.gl.domElement),function(){}}),[a,l]),_.createPortal(n.createElement("div",{ref:o,className:"editor-module_embed__2iwnO "+(!e.diffMode&&e.fullScreen&&e.showEditor?"editor-module_embedfull__9UVqb":"")},n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"54",height:"14",viewBox:"0 0 54 14"},n.createElement("g",{fill:"none",fillRule:"evenodd",transform:"translate(1 1)"},n.createElement("circle",{cx:"6",cy:"6",r:"6",fill:"#FF5F56",stroke:"#E0443E",strokeWidth:".5"}),n.createElement("circle",{cx:"26",cy:"6",r:"6",fill:"#FFBD2E",stroke:"#DEA123",strokeWidth:".5"}),n.createElement("circle",{cx:"46",cy:"6",r:"6",fill:"#27C93F",stroke:"#1AAB29",strokeWidth:".5"}))),n.createElement("div",{className:"editor-module_embedglass__2BjeI"})),a)},T={base:"vs-dark",inherit:!0,rules:[{background:"272822",token:""},{foreground:"75715e",token:"comment"},{foreground:"e6db74",token:"string"},{foreground:"ae81ff",token:"constant.numeric"},{foreground:"ae81ff",token:"constant.language"},{foreground:"ae81ff",token:"constant.character"},{foreground:"ae81ff",token:"constant.other"},{foreground:"f92672",token:"keyword"},{foreground:"f92672",token:"storage"},{foreground:"66d9ef",fontStyle:"italic",token:"storage.type"},{foreground:"a6e22e",fontStyle:"underline",token:"entity.name.class"},{foreground:"a6e22e",fontStyle:"italic underline",token:"entity.other.inherited-class"},{foreground:"a6e22e",token:"entity.name.function"},{foreground:"fd971f",fontStyle:"italic",token:"variable.parameter"},{foreground:"f92672",token:"entity.name.tag"},{foreground:"a6e22e",token:"entity.other.attribute-name"},{foreground:"66d9ef",token:"support.function"},{foreground:"66d9ef",token:"support.constant"},{foreground:"66d9ef",fontStyle:"italic",token:"support.type"},{foreground:"66d9ef",fontStyle:"italic",token:"support.class"},{foreground:"f8f8f0",background:"f92672",token:"invalid"},{foreground:"f8f8f0",background:"ae81ff",token:"invalid.deprecated"},{foreground:"cfcfc2",token:"meta.structure.dictionary.json string.quoted.double.json"},{foreground:"75715e",token:"meta.diff"},{foreground:"75715e",token:"meta.diff.header"},{foreground:"f92672",token:"markup.deleted"},{foreground:"a6e22e",token:"markup.inserted"},{foreground:"e6db74",token:"markup.changed"},{foreground:"ae81ffa0",token:"constant.numeric.line-number.find-in-files - match"},{foreground:"e6db74",token:"entity.name.filename.find-in-files"}],colors:{"editor.foreground":"#F8F8F2","editor.background":"#272822","editor.selectionBackground":"#49483E","editor.lineHighlightBackground":"#3E3D32","editorCursor.foreground":"#F8F8F0","editorWhitespace.foreground":"#3B3A32","editorIndentGuide.activeBackground":"#9D550FB0","editor.selectionHighlightBorder":"#222218"}},q=function(){var e=exports.editorContext.monacoRef.editor.getModel(x.activeMaterial.model+"_orig"),t=exports.editorContext.monacoRef.editor.getModel(x.activeMaterial.model);if(e&&t)var n=e.getValue(),r=t.getValue();x.activeMaterial.isModif=n!==r},J=function(){var e=t.useState(!1),r=e[0],o=e[1];return t.useLayoutEffect((function(){"undefined"==typeof window||exports.editorContext.monacoRef||a.loader.init().then((function(e){exports.editorContext.monacoRef=e,exports.editorContext.monacoRef.editor.defineTheme("monokai",T),o(!0),e.languages.register({id:"cshader"}),e.languages.setLanguageConfiguration("cshader",C),e.languages.setMonarchTokensProvider("cshader",k)})).catch((function(e){return console.error("An error occurred during initialization of Monaco: ",e)}))})),n.createElement(n.Fragment,null,r&&n.createElement(H,null))},W=function(){var e=r.useProxy(x);return t.useEffect((function(){!function(){var e=x.diagnostics;if(x.activeMaterial.model){var t=exports.editorContext.activeMaterialRef[x.activeMaterial.model].material;if(e&&e.fragmentShader&&!e.runnable&&exports.editorContext.monacoRef){var n=""===e.fragmentShader.log?e.vertexShader:e.fragmentShader,r=n.log.split("\n"),o=n.prefix.split("\n");r.pop();var i=0,a=r.map((function(n){if(t&&t.isEffect&&exports.editorContext.editor){var r=x.activeMaterial.type,a="frag"===r?"e"+t.id+"MainImage":"e"+t.id+"MainUv",l=("frag"===r?e.frag:e.vert).split("\n");i=l.findIndex((function(e){return e.includes(a)}));var d=exports.editorContext.editor.getModel();if(d){var s=d.getValue().split("\n"),c="frag"===r?"mainImage":"mainUv",u=s.findIndex((function(e){return e.includes(c)}));i-=u}}var m=new RegExp("[^0-9]+ ([0-9]+):([0-9]+):"),f=n.match(m)||[],p=n.split(":");p[2]=(parseInt(p[2])-(t.isEffect?i:o.length)||"").toString();var g=parseInt(f[1]||1),v=parseInt(f[2]||1)-(t.isEffect?i:o.length);return{startLineNumber:v,startColumn:g,endLineNumber:v,endColumn:1e3,message:p.join(":"),severity:exports.editorContext.monacoRef.MarkerSeverity.Error}}));exports.editorContext.monacoRef.editor.setModelMarkers(exports.editorContext.editor.getModel(),x.activeMaterial.model,a)}}}()}),[e.diagnostics]),null},H=function(){var e=t.useRef(null),o=r.useProxy(x);return exports.editorContext.dom=e,n.createElement("div",{ref:e,className:"editor-module_editor_c__16HRX "+(o.showEditor?"":"editor-module_editor_h__MRECc")+" "+(o.showEditor&&o.fullScreen?"editor-module_full__2cjlZ":"")+" "+x.className},n.createElement(D,null),b.gl&&n.createElement(V,null),o.showEditor&&n.createElement(X,null))},Z=function(){var e=r.useProxy(x),o=t.useState(!1),i=o[0],a=o[1];return t.useEffect((function(){if(x.activeMaterial&&exports.editorContext.activeMaterialRef&&exports.editorContext.monacoRef&&x.activeMaterial.model){var e=x.activeMaterial.type,t=exports.editorContext.activeMaterialRef[x.activeMaterial.model];if(!t)return;var n=t.material;if(i&&n){var r,o=O(n,t.program);r=w("frag"===e?n.fragmentShader:n.vertexShader),exports.editorContext.monacoRef.editor.getModel("urn:"+o+"."+e+"_orig")||(exports.editorContext.monacoRef.editor.createModel(r,"cshader","urn:"+o+"."+e+"_orig"),"ShaderMaterial"===n.type||"RawShaderMaterial"===n.type||n.isEffect||exports.editorContext.editor.trigger("fold","editor.foldLevel1"))}}}),[i,e.activeMaterial,exports.editorContext.monacoRef]),n.createElement(l,{className:"editor-module_editor__1MUvb",language:"cshader",theme:"vs-dark",onMount:function(e,t){exports.editorContext.editor=e,a(!0)},height:"100%",keepCurrentModel:!0,path:e.activeMaterial.model+"",defaultLanguage:"urn:obc_result"===e.activeMaterial.model?"javascript":"cshader",defaultValue:function(){if(!x.activeMaterial.model)return"";var e,t=x.activeMaterial.type,n=x.activeMaterial.model,r=exports.editorContext.activeMaterialRef[x.activeMaterial.model];if(r){var o=r.program,i=r.material;"frag"===t?e=w(i?i.fragmentShader:o.fragmentShader):"vert"===t&&(e=w(i?i.vertexShader:o.vertexShader))}if("urn:obc_result"===n&&x.obcMode){var a=function(e){var t=x.activeMaterial.cachedModel,n="frag"===x.activeMaterial.type?"fragmentShader":"vertexShader",r=exports.editorContext.monacoRef.editor.getModel(t+"_orig").getValue(),o=exports.editorContext.monacoRef.editor.getModel(t).getValue(),i=E(r),a=E(o),l=new Map;if(!i||!a)return"";for(var d=0;d<i.length;d++){var s=a[d];i[d]!==s&&l.set(a[d-1],s)}var c="// generated using three-material-editor\nmaterial.onBeforeCompile = (shader) => {\n";return l.forEach((function(e,t){var r=e.length>500?e.trim().replace(/(\r\n|\n|\r)/gm,""):e;c+=(e.length>500?"\t// > 500 characters - auto minified\n":"")+"\tshader."+n+" = shader."+n+".replace(`#include <"+t+">`, `"+r+" `);\n"})),c+="}\n",x.obcMode=!0,x.triggerUpdate++,c}();return exports.editorContext.monacoRef.editor.getModel("urn:obc_result")&&exports.editorContext.monacoRef.editor.getModel("urn:obc_result").setValue(a),a}return e}(),onChange:function(t){return x.obcMode||function(e,t){if(x.activeMaterial.model){var n=exports.editorContext.activeMaterialRef[x.activeMaterial.model],r=n.material;exports.editorContext.monacoRef.editor.setModelMarkers(exports.editorContext.editor.getModel(),x.activeMaterial.model,e),r&&(r.isEffect?(r.vertexShader="vert"===t?e:r.vertexShader,r.fragmentShader="frag"===t?e:r.fragmentShader,n.effect.recompile(exports.editorContext.gl)):r.editorOnBeforeCompile=function(n){n.vertexShader="vert"===t?e:r.vertexShader,n.fragmentShader="frag"===t?e:r.fragmentShader},q(),r.needsUpdate=!0,x.triggerUpdate++,r.customProgramCacheKey=function(){return x.triggerUpdate})}}(t,e.activeMaterial.type),!1},options:{formatOnType:!0,foldingHighlight:!1,folding:!0,foldingStrategy:"auto"}})},$=function(){var e=x.activeMaterial.model,r=t.useState(!1),o=r[0],i=r[1],l=exports.editorContext.monacoRef.editor.getModel(e+"_orig"),d=exports.editorContext.monacoRef.editor.getModel(e);return t.useEffect((function(){return o&&(exports.editorContext.monacoRef.editor.getModel("diff_1")||exports.editorContext.monacoRef.editor.createModel(l.getValue(),"cshader","diff_1"),exports.editorContext.monacoRef.editor.getModel("diff_2")||exports.editorContext.monacoRef.editor.createModel(d.getValue(),"cshader","diff_2"),exports.editorContext.diffEditor.setModel({original:exports.editorContext.monacoRef.editor.getModel("diff_1"),modified:exports.editorContext.monacoRef.editor.getModel("diff_2")})),function(){exports.editorContext.editor.getModel()&&exports.editorContext.diffEditor.getModel().modified.getValue()&&exports.editorContext.monacoRef.editor.getModel(x.activeMaterial.model).setValue(exports.editorContext.diffEditor.getModel().modified.getValue()),exports.editorContext.monacoRef.editor.createDiffNavigator(exports.editorContext.diffEditor,{followsCaret:!0,ignoreCharChanges:!0}).next()}}),[o,d,l]),n.createElement(a.DiffEditor,{className:"editor-module_editor__1MUvb",onMount:function(e,t){exports.editorContext.diffEditor=e,i(!0)},theme:"vs-dark",height:"100%",options:{formatOnType:!0}})},X=function(){var e=r.useProxy(x);return e.showEditor?n.createElement(n.Fragment,null,e.activeMaterial.type&&n.createElement(n.Fragment,null,n.createElement(W,null),n.createElement(S,null)),Object.keys(e.tabs).length>0&&n.createElement(Z,null),e.showEditor&&e.diffMode&&e.activeMaterial.type&&n.createElement($,null)):null};function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function G(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return K(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?K(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}var Q=function(e){var t=e,n=function(e){var t=U[e.type],n=Object.assign({},i.ShaderLib[t]?i.ShaderLib[t]:e);if(i.ShaderLib[t])for(var r=0,o=Object.entries(n.uniforms);r<o.length;r++)o[r][1].isNativeUniforms=!0;return n.obcAdded||e.obcAdded||(e.obcAdded=!0,n.obcAdded=!0,e.onBeforeCompile.call(e,n),n.uniforms=Object.assign(n.uniforms,e.uniforms)),n}(t);t=Object.assign(t,n);var r=Date.now(),o=b.gl.domElement,a=new i.Vector2(o.clientWidth,o.clientHeight);return setTimeout((function(){t.onBeforeCompile=function(e){t.postprocess||(e.uniforms=Object.assign(e.uniforms,t.uniforms)),this.editorOnBeforeCompile&&this.editorOnBeforeCompile.call(this,e),e.uniforms.time&&!t.postprocess&&(e.uniforms.time={writable:!0,configurable:!0,get value(){return(Date.now()-r)/1e3}}),e.uniforms.resolution&&(e.uniforms.resolution={writable:!0,configurable:!0,get value(){return a}})}}),0),{debug:null,material:t}},Y=function(e){return"muidEditor"===e},ee={},te=[],ne=function(e,t,n){var r=n?e.screen:e;r.material.defines||(r.material.defines={}),r.material.defines.muidEditor||(r.material.defines=Object.assign(r.material.defines||{},{muidEditor:r.material.id}));var o=r.material.id;if(o&&!t[o]&&r.material.defines){var i=Q(r.material);if(r.material=i.material,r.tmeDerived=!0,r.material.numberOfMaterialsUser=1,t[o]=r.material,t[o].mesh=r,e.effects){for(var a,l=0,d=G(e.effects);!(a=d()).done;){var s=a.value;s.id=l++,s.isEffect=!0}r.material.postprocess=e,e.recompile()}}};new i.Mesh(void 0,new i.MeshBasicMaterial({color:new i.Color(16711680),side:i.FrontSide,wireframe:!0,visible:!1})).debugMaterial=!0,exports.EditorDom=function(){return null},exports.editorState={},exports.editorContext={},exports.materialsToProgram={},"SHOW"!==process.env.TME_PROD||(exports.EditorDom=function(){return n.createElement(J,null)},exports.editorState=x,exports.editorContext=b,exports.materialsToProgram=function(e,t){var n;b.gl=t,b.composer&&b.composer.passes.forEach((function(e){e.fsQuad&&function(e,t){var n=e.material.id;if(n&&!t[n]){var r=Q(e.material);e.material=r.material,e.tmeDerived=!0,e.material.postprocess=!0,t[n]=e.material,t[n].mesh=e}}(e,te),e.screen&&ne(e,ee,!0)}));var r=[];null==e||e.traverse((function(e){if(e.material){if(e.debugMaterial)return;ne(e,ee),e.material.defines&&!e.tmeDerived&&(e.tmeDerived=!0,e.material.numberOfMaterialsUser++)}})),null==(n=t.info.programs)||n.forEach((function(e){var n=e.cacheKey.split(","),o=n[n.findIndex(Y)+1];if(!isNaN(o)&&ee[o]){if(ee[o].program=e,ee[o].postprocess)for(var i,a=G(ee[o].postprocess.effects);!(i=a()).done;)r.push({material:i.value,program:e,effect:ee[o].postprocess});else r.push({material:ee[o],program:e});if(e){var l=e;if(l.diagnostics&&(x.diagnostics=l.diagnostics,x.diagnostics)){var d=t.getContext().getShaderSource(l.fragmentShader),s=t.getContext().getShaderSource(l.fragmentShader);x.diagnostics.frag=d,x.diagnostics.vert=s}}}else{var c=te.filter((function(e){return e.fragmentShader.includes(n[0])}));c.length>0&&c.forEach((function(t){r.push({material:t,program:e})}))}})),r.length!==b.programs.length&&(b.programs=r,x.triggerUpdate++)});
//# sourceMappingURL=core.cjs.production.min.js.map
